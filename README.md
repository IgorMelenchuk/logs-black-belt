
# **–ú–û–î–£–õ–¨ 1. –û–°–ù–û–í–´ –õ–û–ì–ò–†–û–í–ê–ù–ò–Ø**

### –¶–µ–ª—å

–ü–æ–Ω—è—Ç—å, –∑–∞—á–µ–º –Ω—É–∂–Ω—ã –ª–æ–≥–∏, –∫–∞–∫–∏–µ –æ–Ω–∏ –±—ã–≤–∞—é—Ç –∏ –∫–∞–∫ –∏—Ö –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –Ω–∞ –±–∞–∑–æ–≤–æ–º —É—Ä–æ–≤–Ω–µ.
–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –º–æ–¥—É–ª—è —Ç—ã —Å–º–æ–∂–µ—à—å —É–≤–µ—Ä–µ–Ω–Ω–æ —á–∏—Ç–∞—Ç—å, —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –∏ –Ω–∞–ø—Ä–∞–≤–ª—è—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ª–æ–≥–∏ Linux-–º–∞—à–∏–Ω—ã.

---

## 1. –ß—Ç–æ —Ç–∞–∫–æ–µ –ª–æ–≥ –∏ –∑–∞—á–µ–º –æ–Ω –Ω—É–∂–µ–Ω

–õ–æ–≥ (–æ—Ç –∞–Ω–≥–ª. log ‚Äî ¬´–∂—É—Ä–Ω–∞–ª¬ª) ‚Äî —ç—Ç–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∑–∞–ø–∏—Å—å –æ —Å–æ–±—ã—Ç–∏–∏ –≤ —Å–∏—Å—Ç–µ–º–µ.
–ö–∞–∂–¥—ã–π –ª–æ–≥ –∏–º–µ–µ—Ç:

* **–∏—Å—Ç–æ—á–Ω–∏–∫** (–ø—Ä–æ–≥—Ä–∞–º–º–∞, —Å–µ—Ä–≤–∏—Å, —è–¥—Ä–æ);
* **–≤—Ä–µ–º—è** —Å–æ–±—ã—Ç–∏—è;
* **—É—Ä–æ–≤–µ–Ω—å –≤–∞–∂–Ω–æ—Å—Ç–∏** (–æ—Ç `DEBUG` –¥–æ `CRITICAL`);
* **—Å–æ–æ–±—â–µ–Ω–∏–µ** ‚Äî —Ç–µ–∫—Å—Ç –∏–ª–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö.

**–ì–ª–∞–≤–Ω—ã–µ —Ü–µ–ª–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:**

1. –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ ‚Äî –ø–æ–Ω—è—Ç—å, —á—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫.
2. –ê—É–¥–∏—Ç ‚Äî –∫—Ç–æ, –∫–æ–≥–¥–∞ –∏ —á—Ç–æ —Å–¥–µ–ª–∞–ª.
3. –ú–µ—Ç—Ä–∏–∫–∏ ‚Äî –ø–æ–Ω–∏–º–∞–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏, –∑–∞–¥–µ—Ä–∂–µ–∫, –æ—à–∏–±–æ–∫.
4. –§–æ—Ä–µ–Ω–∑–∏–∫–∞ ‚Äî –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–ø–æ—á–∫–∏ —Å–æ–±—ã—Ç–∏–π –ø—Ä–∏ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–µ.

---

## 2. –¢–∏–ø—ã –ª–æ–≥–æ–≤

| –¢–∏–ø                  | –ü—Ä–∏–º–µ—Ä—ã                     | –ì–¥–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è                           |
| -------------------- | --------------------------- | -------------------------------------- |
| **–°–∏—Å—Ç–µ–º–Ω—ã–µ**        | kernel, systemd, cron       | `/var/log/syslog`, `/var/log/messages` |
| **–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–π**   | nginx, postgres, python-app | `/var/log/nginx/access.log`            |
| **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**     | auditd, auth.log            | `/var/log/auth.log`                    |
| **–°–µ—Ç–µ–≤—ã–µ**          | firewall, VPN               | `/var/log/iptables.log`                |
| **–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ** | docker, k8s, CI/CD          | —á–µ—Ä–µ–∑ stdout/stderr ‚Üí –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä—ã       |

---

## üîç –ü—Ä–∏–º–µ—Ä—ã –ª–æ–≥–æ–≤ –ø–æ —Ç–∏–ø–∞–º

---

### **2.1. –°–∏—Å—Ç–µ–º–Ω—ã–µ –ª–æ–≥–∏**

–ñ—É—Ä–Ω–∞–ª–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏—è —è–¥—Ä–∞, systemd, cron, –∑–∞–≥—Ä—É–∑–∫—É –∏ –≤—ã–∫–ª—é—á–µ–Ω–∏–µ –º–∞—à–∏–Ω—ã.

**–§–∞–π–ª:** `/var/log/syslog` –∏–ª–∏ `/var/log/messages`

**–ü—Ä–∏–º–µ—Ä—ã:**

```
Oct 07 09:32:11 debian kernel: [  105.544229] eth0: link up, 1000 Mbps, full-duplex
Oct 07 09:33:00 debian systemd[1]: Started Session 42 of user igor.
Oct 07 09:34:11 debian CRON[2764]: (root) CMD (/usr/local/bin/backup.sh)
Oct 07 09:34:15 debian systemd[1]: Stopping Nginx Web Server...
Oct 07 09:34:16 debian systemd[1]: nginx.service: Succeeded.
```

> **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:**
> –¢–∞–∫–∏–µ –ª–æ–≥–∏ –ø–æ–ª–µ–∑–Ω—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤, –∑–∞–≤–∏—Å–∞–Ω–∏–π systemd-—Å–µ—Ä–≤–∏—Å–æ–≤, cron-—Ç–∞—Å–∫–æ–≤ –∏ —Å–æ–±—ã—Ç–∏–π —è–¥—Ä–∞.

---

### **2.2. –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π**

–ñ—É—Ä–Ω–∞–ª–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –ø—Ä–æ–≥—Ä–∞–º–º –∏ —Å–µ—Ä–≤–∏—Å–æ–≤ (nginx, PostgreSQL, Python-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, backend-—Å–µ—Ä–≤–∏—Å—ã).

**–§–∞–π–ª—ã:**

* `/var/log/nginx/access.log`
* `/var/log/nginx/error.log`
* `/var/log/postgresql/postgresql-15-main.log`

**–ü—Ä–∏–º–µ—Ä—ã:**

`access.log`

```
192.168.1.10 - - [07/Oct/2025:10:14:55 +0300] "GET /api/v1/users HTTP/1.1" 200 532 "-" "curl/7.88.1"
```

`error.log`

```
2025/10/07 10:15:12 [error] 2148#2148: *42 upstream timed out (110: Connection timed out) while reading response header from upstream, client: 192.168.1.10, server: api.local, request: "GET /api/v1/users HTTP/1.1", upstream: "http://127.0.0.1:8000/users"
```

`application.log` (–ø—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ Python-–ª–æ–≥–∞)

```json
{"timestamp": "2025-10-07T10:16:00Z", "level": "INFO", "service": "billing", "user_id": 312, "message": "Payment processed successfully"}
```

> **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:**
> –ü—Ä–∏–ª–æ–∂–µ–Ω—á–µ—Å–∫–∏–µ –ª–æ–≥–∏ —á–∞—â–µ –≤—Å–µ–≥–æ —Ç—Ä–µ–±—É—é—Ç –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –ø–æ–ª—è–º (`user_id`, `service`, `status_code`).

---

### **2.3. –õ–æ–≥–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**

–§–∏–∫—Å–∏—Ä—É—é—Ç –ø–æ–ø—ã—Ç–∫–∏ –≤—Ö–æ–¥–∞, sudo, –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∞–≤, –∑–∞–ø—É—Å–∫ –¥–µ–º–æ–Ω–æ–≤.

**–§–∞–π–ª:** `/var/log/auth.log` –∏–ª–∏ `/var/log/secure`

**–ü—Ä–∏–º–µ—Ä—ã:**

```
Oct 07 10:21:18 debian sshd[3181]: Failed password for root from 185.241.56.77 port 51822 ssh2
Oct 07 10:21:22 debian sshd[3181]: Accepted password for igor from 192.168.1.20 port 51244 ssh2
Oct 07 10:21:25 debian sudo:     igor : TTY=pts/0 ; PWD=/home/igor ; USER=root ; COMMAND=/bin/systemctl restart nginx
Oct 07 10:21:26 debian su[3210]: (to postgres) igor on pts/0
```

> **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:**
> –≠—Ç–∏ –ª–æ–≥–∏ ‚Äî —Å–æ–∫—Ä–æ–≤–∏—â–µ –¥–ª—è SOC –∏ forensics. –û–Ω–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç, –∫—Ç–æ, –∫–æ–≥–¥–∞ –∏ –∫–∞–∫ –≤—Ö–æ–¥–∏–ª –≤ —Å–∏—Å—Ç–µ–º—É, —á—Ç–æ –∑–∞–ø—É—Å–∫–∞–ª –∏ —Å –∫–∞–∫–∏–º–∏ –ø—Ä–∏–≤–∏–ª–µ–≥–∏—è–º–∏.

---

### **2.4. –°–µ—Ç–µ–≤—ã–µ –ª–æ–≥–∏**

–û—Ç—Ä–∞–∂–∞—é—Ç —Ç—Ä–∞—Ñ–∏–∫, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ø–∞–∫–µ—Ç–æ–≤, NAT, VPN –∏ —Å–æ–±—ã—Ç–∏—è —Å–µ—Ç–µ–≤—ã—Ö —Å–ª—É–∂–±.

**–§–∞–π–ª—ã:**

* `/var/log/iptables.log`
* `/var/log/openvpn.log`
* `/var/log/dnsmasq.log`

**–ü—Ä–∏–º–µ—Ä—ã:**

`iptables.log`

```
Oct 07 10:25:09 debian kernel: [ 132.3121] IPTABLES DROP IN=eth0 OUT= MAC=02:42:ac:11:00:02 SRC=5.61.12.34 DST=192.168.0.2 LEN=60 TOS=0x00 PREC=0x00 TTL=51 ID=54321 DF PROTO=TCP SPT=58214 DPT=22 WINDOW=65535 RES=0x00 SYN URGP=0
```

`openvpn.log`

```
Tue Oct 07 10:26:00 2025 [client1] Peer Connection Initiated with [AF_INET]203.0.113.45:1194
Tue Oct 07 10:26:10 2025 client1/203.0.113.45 Data Channel: TLSv1.3, cipher TLS_AES_256_GCM_SHA384
```

> **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:**
> –î–ª—è —Å–µ—Ç–µ–≤–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ —ç—Ç–∏ –ª–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –¥—Ä–æ–ø–Ω—É—Ç—ã–µ –ø–∞–∫–µ—Ç—ã, VPN-—Å–µ—Å—Å–∏–∏ –∏ –∞–Ω–æ–º–∞–ª—å–Ω—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, flood –Ω–∞ –ø–æ—Ä—Ç 22).

---

### **2.5. –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ (–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä—ã)**

–†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç —Å–æ–±—ã—Ç–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤, –¥–µ–ø–ª–æ–π–º–µ–Ω—Ç–æ–≤, –ø–∞–π–ø–ª–∞–π–Ω–æ–≤ CI/CD –∏ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏ (Docker, Kubernetes, GitLab CI).

**–ò—Å—Ç–æ—á–Ω–∏–∫–∏:**

* `docker logs`
* `/var/log/containers/*.log`
* `/var/log/pods/*.log`
* Jenkins, GitLab Runner

**–ü—Ä–∏–º–µ—Ä—ã:**

`docker logs webapp`

```
2025-10-07T10:30:42Z INFO  Starting HTTP server on :8080
2025-10-07T10:31:01Z ERROR DB connection failed: timeout
2025-10-07T10:31:03Z INFO  Retrying in 5s...
```

`kubelet.log`

```
Oct 07 10:32:10 kubelet[8123]: Started container nginx in pod web-frontend-54fd8
Oct 07 10:32:25 kubelet[8123]: Liveness probe failed: HTTP probe failed with statuscode: 500
```

`gitlab-runner.log`

```
Running with gitlab-runner 16.4.0 (12b6e5f8)
[INFO] Job succeeded in 3m12s (stage: deploy)
```

> **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:**
> –≠—Ç–∏ –ª–æ–≥–∏ ‚Äî –æ—Å–Ω–æ–≤–∞ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è CI/CD –∏ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤. –û–Ω–∏ –∏–¥—É—Ç —á–µ—Ä–µ–∑ stdout/stderr –∏ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è Fluent Bit/Fluentd –∏–∑ `/var/lib/docker/containers`.


---

> **Best practice:**
> –•—Ä–∞–Ω–∏ —Ö–æ—Ç—è –±—ã 7‚Äì14 –¥–Ω–µ–π –ª–æ–≥–æ–≤ –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –≤ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ (ELK, Loki, Graylog).
> –ù–∞—Å—Ç—Ä–æ–π –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ —Ç–∏–ø—É (`system-*`, `app-*`, `security-*`), —á—Ç–æ–±—ã —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –º–∏–ª–ª–∏–æ–Ω—ã —Å—Ç—Ä–æ–∫ –∑–∞ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã.

---


## ‚öôÔ∏è 3. –§–æ—Ä–º–∞—Ç—ã –ª–æ–≥–æ–≤ 

### 3.1. Plain text ‚Äî ‚Äú–¥–µ–¥–æ–≤—Å–∫–∏–π‚Äù —Ñ–æ—Ä–º–∞—Ç

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–°–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π –≤–∞—Ä–∏–∞–Ω—Ç ‚Äî –æ–±—ã—á–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ —Ç–µ–∫—Å—Ç–∞ –±–µ–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã. –ö–∞–∂–¥—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –ª–æ–≥–∞ (–≤—Ä–µ–º—è, –ø—Ä–æ—Ü–µ—Å—Å, —Å–æ–æ–±—â–µ–Ω–∏–µ) —Ä–∞–∑–¥–µ–ª—ë–Ω –ø—Ä–æ–±–µ–ª–∞–º–∏ –∏–ª–∏ —Ç–∞–±–∞–º–∏, –Ω–æ —Ñ–æ—Ä–º–∞—Ç –Ω–∏–∫–∞–∫ –Ω–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω.

**–ü—Ä–∏–º–µ—Ä:**

```
[07/Oct/2025 10:15:24] Service started successfully on port 8080
[07/Oct/2025 10:16:02] Connection timeout for user 312
```

**–ü–ª—é—Å—ã:**

* –ß–∏—Ç–∞–µ—Ç—Å—è –≥–ª–∞–∑–∞–º–∏, –¥–∞–∂–µ –±–µ–∑ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤.
* –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ CPU –ø—Ä–∏ –∑–∞–ø–∏—Å–∏.

**–ú–∏–Ω—É—Å—ã:**

* –ü–∞—Ä—Å–∏–Ω–≥ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞: –¥–ª—è –æ–¥–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ —Ñ–æ—Ä–º–∞—Ç ‚ÄúYYYY-MM-DD‚Äù, –¥–ª—è –¥—Ä—É–≥–æ–≥–æ ‚ÄúDD/Mon/YYYY‚Äù.
* –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ grep –∏ regex –º–µ–¥–ª–µ–Ω–Ω—ã–µ –∏ –Ω–µ–Ω–∞–¥—ë–∂–Ω—ã–µ.
* –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã (Fluentd, Graylog) —Ç—Ä–∞—Ç—è—Ç —Ä–µ—Å—É—Ä—Å—ã –Ω–∞ –ø–∞—Ä—Å–∏–Ω–≥.

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
–õ–∏–±–æ –≤ –ø—Ä–æ—Å—Ç—ã—Ö CLI-—É—Ç–∏–ª–∏—Ç–∞—Ö, –ª–∏–±–æ –∫–∞–∫ –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –≤ –ø–µ—Å–æ—á–Ω–∏—Ü–µ. –í –ø—Ä–æ–¥–∞–∫—à–Ω–µ ‚Äî –∏–∑–±–µ–≥–∞—Ç—å.

---

### 3.2. Syslog-—Ñ–æ—Ä–º–∞—Ç ‚Äî –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç RFC 3164 / RFC 5424

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–ö–ª–∞—Å—Å–∏–∫–∞ UNIX-–º–∏—Ä–∞. –ö–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ `<PRI>` (–≤ –Ω—ë–º –∫–æ–¥–∏—Ä—É—é—Ç—Å—è facility –∏ severity), –∑–∞—Ç–µ–º –∏–¥—ë—Ç –≤—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞, —Ö–æ—Å—Ç, –ø—Ä–æ—Ü–µ—Å—Å –∏ —Å–æ–æ–±—â–µ–Ω–∏–µ.
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–µ–º–æ–Ω–æ–º **rsyslog**, **syslog-ng**, **journald**, —Å–µ—Ç–µ–≤—ã–º–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏ –∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏.

**–ü—Ä–∏–º–µ—Ä (RFC 3164):**

```
<34>Oct 07 10:20:15 web01 nginx[2148]: access from 192.168.1.10 status=200 path=/api/v1/users
```

**–ü—Ä–∏–º–µ—Ä (RFC 5424):**

```
<165>1 2025-10-07T10:21:00Z web01 nginx 2148 ID47 [origin ip="192.168.1.10"] request="GET /api"
```

**–ü–æ—è—Å–Ω–µ–Ω–∏–µ:**

* `<34>` ‚Äî –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç: facility *daemon*=3, severity *info*=4 ‚Üí (3√ó8)+4=28, –Ω–æ —Ç—É—Ç –ø—Ä–∏–º–µ—Ä 34.
* `Oct 07 10:20:15` ‚Äî timestamp.
* `web01` ‚Äî –∏–º—è —Ö–æ—Å—Ç–∞.
* `nginx[2148]` ‚Äî –ø—Ä–æ—Ü–µ—Å—Å –∏ PID.
* –°–æ–æ–±—â–µ–Ω–∏–µ ‚Äî –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç –∏–ª–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–∞—Ä—ã `key=value`.

**–ü–ª—é—Å—ã:**

* –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –ø–æ—á—Ç–∏ –≤—Å–µ–º —Å–æ—Ñ—Ç–æ–º.
* –ü–æ–∑–≤–æ–ª—è–µ—Ç –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ —É—Ä–æ–≤–Ω—é –∏ facility (`auth`, `daemon`, `kern` –∏ —Ç.–¥.).
* –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–µ—Ç–µ–≤—É—é –ø–µ—Ä–µ–¥–∞—á—É (UDP/TCP/RELP).

**–ú–∏–Ω—É—Å—ã:**

* –ù–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å—Ç—Ä–æ–≥–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã ‚Äî –ø–∞—Ä—Å–∏–Ω–≥ –º–æ–∂–µ—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è —É —Ä–∞–∑–Ω—ã—Ö —Å–∏—Å—Ç–µ–º.
* –°—Ç–∞—Ä—ã–π RFC 3164 –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã –∏ —Ç–∞–π–º–∑–æ–Ω—ã.
* –ù–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ –≤–µ–¥—ë—Ç —Å–µ–±—è –ø—Ä–∏ Unicode-—Å–∏–º–≤–æ–ª–∞—Ö.

**Best practice:**
–ü–µ—Ä–µ—Ö–æ–¥–∏ –Ω–∞ RFC 5424, –≥–¥–µ —Ñ–æ—Ä–º–∞—Ç —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏ –≤—Ä–µ–º—è —É–∫–∞–∑–∞–Ω–æ –≤ ISO 8601 (UTC).

---

### 3.3. JSON ‚Äî —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç ‚Äú–Ω–æ–≤–æ–π —à–∫–æ–ª—ã‚Äù

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–ö–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ ‚Äî JSON-–æ–±—ä–µ–∫—Ç. –≠—Ç–æ –∏–¥–µ–∞–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –¥–ª—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (Fluentd, ELK, Loki, Vector).
–ü–æ–∑–≤–æ–ª—è–µ—Ç —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å, –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞—Ç—å –∏ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏ –ø–æ –ø–æ–ª—è–º, –∞ –Ω–µ –ø–æ —Å—Ç—Ä–æ–∫–∞–º.

**–ü—Ä–∏–º–µ—Ä:**

```json
{
  "timestamp": "2025-10-07T10:23:14Z",
  "level": "ERROR",
  "service": "auth-api",
  "user_id": 314,
  "message": "Failed login attempt",
  "ip": "192.168.1.10"
}
```

**–ü–ª—é—Å—ã:**

* –ú–∞—à–∏–Ω–æ—á–∏—Ç–∞–µ–º—ã–π –∏ —Å–∞–º–æ–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É—é—â–∏–π—Å—è —Ñ–æ—Ä–º–∞—Ç.
* –ò–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è ElasticSearch –∏ Grafana Loki.
* –ü—Ä–æ—Å—Ç–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–ª—é—á–∞–º (`level:error`, `service:auth-api`).
* –£–¥–æ–±–µ–Ω –¥–ª—è —Å–ª–∏—è–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ä–∞–∑–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤.

**–ú–∏–Ω—É—Å—ã:**

* –ß—É—Ç—å –≤—ã—à–µ –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ CPU –∏ –¥–∏—Å–∫.
* –¢—Ä–µ–±—É–µ—Ç —Å—Ç—Ä–æ–≥–æ–π —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏: –æ—à–∏–±–∫–∞ –≤ JSON –ª–æ–º–∞–µ—Ç ingestion.

**Best practice:**

1. –ò—Å–ø–æ–ª—å–∑—É–π –ø–æ–ª—è `timestamp`, `level`, `message`, `service`, `trace_id`, `user_id`.
2. –í—Å–µ–≥–¥–∞ –≤ UTC (`Z` –Ω–∞ –∫–æ–Ω—Ü–µ –≤—Ä–µ–º–µ–Ω–∏).
3. –ò–∑–±–µ–≥–∞–π –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –≥–ª—É–±–∂–µ 2 —É—Ä–æ–≤–Ω–µ–π ‚Äî Elasticsearch –∏—Ö flatten‚Äô–∏—Ç.

---

### 3.4. CEF / LEEF ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (SIEM-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ)

**CEF (Common Event Format)** –∏ **LEEF (Log Event Extended Format)** –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è SIEM-–ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–º–∏ (ArcSight, QRadar, Splunk).
–û–Ω–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç —Ö—Ä–∞–Ω–∏—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –æ —Å–æ–±—ã—Ç–∏–∏ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π, –Ω–æ –ª—ë–≥–∫–æ–π –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ —Ñ–æ—Ä–º–µ.

**–ü—Ä–∏–º–µ—Ä (CEF):**

```
CEF:0|nginx|webserver|1.0|100|Access denied|5|src=192.168.1.10 spt=443 request=/admin method=GET
```

**–ü–æ—è—Å–Ω–µ–Ω–∏–µ:**

* `CEF:0` ‚Äî –≤–µ—Ä—Å–∏—è.
* `nginx|webserver|1.0` ‚Äî –≤–µ–Ω–¥–æ—Ä, –ø—Ä–æ–¥—É–∫—Ç, –≤–µ—Ä—Å–∏—è.
* `100|Access denied|5` ‚Äî ID, –æ–ø–∏—Å–∞–Ω–∏–µ, —É—Ä–æ–≤–µ–Ω—å.
* –ü–æ—Å–ª–µ `|` –∏–¥—É—Ç –ø–æ–ª—è `key=value`.

**–ü–ª—é—Å—ã:**

* –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è SIEM: –ª–µ–≥–∫–æ —Ä–∞–∑–±–∏—Ä–∞–µ—Ç—Å—è, –ª–æ–≥–∏—á–Ω–æ –∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç—Å—è.
* –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–æ–ª—è —Ç–∏–ø–∞ `src`, `dst`, `spt`, `dpt`, `proto`.

**–ú–∏–Ω—É—Å—ã:**

* –ù–µ –≥–∏–±–∫–∏–π ‚Äî —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –Ω–∞–±–æ—Ä –ø–æ–ª–µ–π.
* –ù–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π (–∏–∑–±—ã—Ç–æ—á–µ–Ω).

**Best practice:**
–ï—Å–ª–∏ —Ç—ã —Ä–∞–±–æ—Ç–∞–µ—à—å –≤ –∫–æ–º–∞–Ω–¥–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ ‚Äî –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–π syslog –≤ CEF –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –≤ SIEM.

---

### 3.5. CSV / TSV

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–¢–∞–±–ª–∏—á–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç, —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Å—Ç–∞—Ä—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö –∏ –æ—Ç—á—ë—Ç–Ω—ã—Ö –ª–æ–≥–∞—Ö.

**–ü—Ä–∏–º–µ—Ä:**

```
timestamp,level,user_id,action,result
2025-10-07T10:30:15Z,INFO,312,login,success
2025-10-07T10:30:17Z,ERROR,312,login,invalid_password
```

**–ü–ª—é—Å—ã:**

* –ü—Ä–æ—Å—Ç–æ–π, –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤ Excel –∏ BI-—Å–∏—Å—Ç–µ–º–∞—Ö.
* –£–¥–æ–±–µ–Ω –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫—É.

**–ú–∏–Ω—É—Å—ã:**

* –ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å –∏ —Ç–∏–ø–∏–∑–∞—Ü–∏—é.
* –ü—Ä–∏ –∑–∞–ø—è—Ç—ã—Ö –≤ —Ç–µ–∫—Å—Ç–µ –ª–æ–º–∞–µ—Ç—Å—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞.
* –ù–µ–ø—Ä–∞–∫—Ç–∏—á–µ–Ω –¥–ª—è realtime-–∞–Ω–∞–ª–∏–∑–∞.


---

### 3.6. Binary (–ø—Ä–æ—Ç–æ–±–∞—Ñ, Avro, Parquet)

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–õ–æ–≥–∏ –≤ –±–∏–Ω–∞—Ä–Ω–æ–º –≤–∏–¥–µ –¥–ª—è –≤—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º –∏ data-pipeline‚Äô–æ–≤ (Kafka, Spark, ClickHouse).

**–ü—Ä–∏–º–µ—Ä:**

```
(–î–≤–æ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, —Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ Protobuf)
```

**–ü–ª—é—Å—ã:**

* –≠–∫–æ–Ω–æ–º–∏—è –º–µ—Å—Ç–∞ –≤ 2-5 —Ä–∞–∑.
* –ë—ã—Å—Ç—Ä–∞—è –¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è.
* –ü–æ–ª–Ω–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è –∏ —Å—Ö–µ–º–∞.

**–ú–∏–Ω—É—Å—ã:**

* –ù–µ —á–∏—Ç–∞—é—Ç—Å—è —á–µ–ª–æ–≤–µ–∫–æ–º.
* –¢—Ä–µ–±—É—é—Ç —Å—Ç—Ä–æ–≥–æ–≥–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —Å—Ö–µ–º–µ.

---

## ‚öôÔ∏è 4. –ü–æ—Ç–æ–∫–∏ stdout –∏ stderr

–ö–∞–∂–¥—ã–π –ø—Ä–æ—Ü–µ—Å—Å –≤ Unix –ø–æ–ª—É—á–∞–µ—Ç —Ç—Ä–∏ –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–∞ ‚Äî –∫–∞–Ω–∞–ª—ã, —á–µ—Ä–µ–∑ –∫–æ—Ç–æ—Ä—ã–µ –∏–¥—ë—Ç –≤–≤–æ–¥-–≤—ã–≤–æ–¥.
–û–Ω–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è —è–¥—Ä–æ–º –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã –∏ –Ω–∞—Å–ª–µ–¥—É—é—Ç—Å—è –¥–æ—á–µ—Ä–Ω–∏–º–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏.

| –ü–æ—Ç–æ–∫      | –ù–æ–º–µ—Ä –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–∞ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                   | –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è       |
| ---------- | ----------------: | ---------------------------- | -------------------------- |
| **stdin**  |                 0 | —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –≤–≤–æ–¥             | `cat` —á–∏—Ç–∞–µ—Ç –∏–∑ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã |
| **stdout** |                 1 | —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –≤—ã–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ | `echo "OK"`                |
| **stderr** |                 2 | —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö         | `ls /root 2>&1`            |

> **–í–∞–∂–Ω–æ:** –¥–∞–∂–µ –µ—Å–ª–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∞ –ø–∞–¥–∞–µ—Ç, `stderr` –æ—Å—Ç–∞—ë—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–º –∫–∞–Ω–∞–ª–æ–º ‚Äî —ç—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–±–æ–π –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –ø–æ–ª–µ–∑–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞.

##### üîπ –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–æ–≤

```bash
python app.py > app.log 2> errors.log
```

1. `>` –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä 1 (stdout) –≤ `app.log`.
2. `2>` –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä 2 (stderr) –≤ `errors.log`.

–¢–∞–∫ —Ç—ã –ø–æ–ª—É—á–∞–µ—à—å —á–∏—Å—Ç—ã–π –ª–æ–≥ –∏ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª –æ—à–∏–±–æ–∫ ‚Äî —ç—Ç–æ –∑–æ–ª–æ—Ç–æ–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è cron-—Ç–∞—Å–∫–æ–≤ –∏ systemd-—Å–µ—Ä–≤–∏—Å–æ–≤.

##### üîπ –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–æ–≤

```bash
python app.py > all.log 2>&1
```

–ö–æ–º–∞–Ω–¥–∞ `2>&1` –æ–∑–Ω–∞—á–∞–µ—Ç: *¬´–æ—Ç–ø—Ä–∞–≤—å stderr —Ç—É–¥–∞, –∫—É–¥–∞ —Å–µ–π—á–∞—Å –∏–¥—ë—Ç stdout¬ª.*
–†–µ–∑—É–ª—å—Ç–∞—Ç ‚Äî –æ–±–∞ –ø–æ—Ç–æ–∫–∞ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ –æ–¥–∏–Ω —Ñ–∞–π–ª, —Å–æ—Ö—Ä–∞–Ω—è—è –ø–æ—Ä—è–¥–æ–∫ –ø–æ –≤—Ä–µ–º–µ–Ω–∏.

##### üîπ –ü–æ–¥ –∫–∞–ø–æ—Ç–æ–º

–ö–æ–≥–¥–∞ —Ç—ã –≤—ã–ø–æ–ª–Ω—è–µ—à—å –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ, shell (bash, zsh) –≤—ã–∑—ã–≤–∞–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤ `dup2()`, —Å–æ–∑–¥–∞–≤–∞—è –∫–æ–ø–∏—é —Ñ–∞–π–ª–æ–≤–æ–≥–æ –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–∞.
–≠—Ç–æ –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è —è–¥—Ä–∞, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–∞—è –≥–∏–±–∫–æ—Å—Ç—å UNIX-–ø–∞–π–ø–ª–∞–π–Ω–æ–≤ (`|`).


##### üîπ –î–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

–í Docker stdout –∏ stderr –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è `containerd` –∏ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –ª–æ–≥-–¥—Ä–∞–π–≤–µ—Ä—É (json-file, journald, Fluent Bit).
–ü–æ—ç—Ç–æ–º—É –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ **–≤—Å–µ–≥–¥–∞ –ª–æ–≥–∏—Ä—É–π —Ç–æ–ª—å–∫–æ –≤ stdout/stderr** ‚Äî –Ω–µ –≤ —Ñ–∞–π–ª—ã.

> üí° **Best practice:** –≤ systemd-—é–Ω–∏—Ç–∞—Ö –∏—Å–ø–æ–ª—å–∑—É–π
> `StandardOutput=journal` –∏ `StandardError=journal`.
> –≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç journald –ø–æ–¥—Ö–≤–∞—Ç—ã–≤–∞—Ç—å –ª–æ–≥–∏ –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ rsyslog-–∫–æ–Ω—Ñ–∏–≥–∞.
---

### 4.1. –ü—Ä–æ–≤–µ—Ä–∏–º –Ω–∞ –ø—Ä–∏–º–µ—Ä–µ

```bash
#!/bin/bash
echo "OK: service started"
>&2 echo "ERROR: database connection failed"
```

–ü—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏:

```bash
bash script.sh > out.log 2> err.log
```

**out.log:**

```
OK: service started
```

**err.log:**

```
ERROR: database connection failed
```

---

### 4.2. –¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏

1. **–ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ stderr –≤ /dev/null**

   ```bash
   ./app 2>/dev/null
   ```

   –≠—Ç–æ –ø–æ–¥–∞–≤–∏—Ç –≤—Å–µ –æ—à–∏–±–∫–∏. –ß–∞—Å—Ç–æ –¥–µ–ª–∞—é—Ç ‚Äú—á—Ç–æ–±—ã –Ω–µ –º–µ—à–∞–ª–∏‚Äù, –Ω–æ –ø–æ—Ç–æ–º –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–æ–Ω—è—Ç—å, –ø–æ—á–µ–º—É —Å–µ—Ä–≤–∏—Å —É–ø–∞–ª.

2. **–°–ª—É—á–∞–π–Ω–æ–µ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–æ–≤**
   –ò–Ω–æ–≥–¥–∞ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã CI/CD (–Ω–∞–ø—Ä–∏–º–µ—Ä, Jenkins) —Å–ª–∏–≤–∞—é—Ç –≤—Å—ë –≤ –æ–¥–∏–Ω –ø–æ—Ç–æ–∫.
   –†–µ–∑—É–ª—å—Ç–∞—Ç ‚Äî –ø—Ä–∏ –∞–ª–µ—Ä—Ç–∏–Ω–≥–µ –ø–æ –∫–ª—é—á–µ–≤–æ–º—É —Å–ª–æ–≤—É ‚ÄúERROR‚Äù –º–æ–∂–µ—Ç —Å—Ä–∞–±–æ—Ç–∞—Ç—å –ª–æ–∂–Ω—ã–π —Å–∏–≥–Ω–∞–ª, –µ—Å–ª–∏ —Å–ª–æ–≤–æ –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è –≤ –æ–±—ã—á–Ω–æ–º –≤—ã–≤–æ–¥–µ.

3. **–í—ã–≤–æ–¥ –±–∏–Ω–∞—Ä–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ stdout**
   –ü—Ä–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–∏ –±–∏–Ω–∞—Ä–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, gzip stdout) –ª—É—á—à–µ —è–≤–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª, —á—Ç–æ–±—ã –Ω–µ –ø–æ–≤—Ä–µ–¥–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å–Ω—ã–π –≤—ã–≤–æ–¥.

---

### 4.3. Best practices

* –í—Å–µ–≥–¥–∞ —Ä–∞–∑–¥–µ–ª—è–π stdout –∏ stderr –≤ —Å–µ—Ä–≤–∏—Å–∞—Ö, –æ—Å–æ–±–µ–Ω–Ω–æ –≤ —Å–∫—Ä–∏–ø—Ç–∞—Ö —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è, –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è, –¥–µ–ø–ª–æ—è.
* –í –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö Docker **–ø–∏—à–∏ –≤—Å—ë –≤ stdout/stderr** ‚Äî –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–Ω—ã–π —Ä–∞–Ω—Ç–∞–π–º —Å–∞–º —Å–æ–±–µ—Ä—ë—Ç —ç—Ç–∏ –ø–æ—Ç–æ–∫–∏ –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç Fluent Bit –∏–ª–∏ journald.
* –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π `2>/dev/null` –≤ –ø—Ä–æ–¥–∞–∫—à–Ω–µ.
* –ï—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å —à—É–º, –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤—å stderr –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª –∏ –ø—Ä–æ–≤–µ—Ä—å –µ–≥–æ –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º.
* –î–ª—è cron-—Ç–∞—Å–∫–æ–≤ –ª–æ–≥–∏—Ä—É–π –æ–±–∞ –ø–æ—Ç–æ–∫–∞:

  ```bash
  /usr/local/bin/backup.sh > /var/log/backup.log 2>&1
  ```

---

## üß≠ 5. Systemd –∏ journald

–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤—ã Linux –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π syslog –∫–∞–∫ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –ª–æ–≥–æ–≤.
–° –ø–µ—Ä–µ—Ö–æ–¥–æ–º –Ω–∞ **systemd** –ø–æ—è–≤–∏–ª—Å—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–≤–∏–∂–æ–∫ –ª–æ–≥–æ–≤ ‚Äî **journald**.

---

### 5.1. –ß—Ç–æ –¥–µ–ª–∞–µ—Ç journald

`journald` —Å–æ–±–∏—Ä–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è –∏–∑:

* —è–¥—Ä–∞ (Linux kernel messages),
* systemd-—Å–µ—Ä–≤–∏—Å–æ–≤,
* —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤ stdout/stderr,
* –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–≥–æ syslog (—á–µ—Ä–µ–∑ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å),
* –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏—Ö API systemd.

–û–Ω —Ö—Ä–∞–Ω–∏—Ç –ª–æ–≥–∏ –≤ –±–∏–Ω–∞—Ä–Ω–æ–π —Ñ–æ—Ä–º–µ (–∫–∞—Ç–∞–ª–æ–≥ `/var/log/journal/`), –∞ —á–∏—Ç–∞–µ—Ç –∏—Ö —É—Ç–∏–ª–∏—Ç–∞ **journalctl**.

---

### 5.2. –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
journalctl -xe
```

–ü–æ–∫–∞–∑–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –æ—à–∏–±–∫–∏, –≤–∫–ª—é—á–∞—è –∫–æ–Ω—Ç–µ–∫—Å—Ç.
–ü–æ–ª–µ–∑–Ω–æ –ø–æ—Å–ª–µ –ø–∞–¥–µ–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞ –∏–ª–∏ systemctl restart.

```bash
journalctl -u nginx.service
```

–í—ã–≤–æ–¥ –ª–æ–≥–æ–≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —é–Ω–∏—Ç–∞ (—Å–ª—É–∂–±—ã).

```bash
journalctl -f
```

–°–ª–µ–¥–∏—Ç—å –∑–∞ –ª–æ–≥–æ–º –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ (–∞–Ω–∞–ª–æ–≥ `tail -f`).

```bash
journalctl --since "2025-10-07 10:00" --until "2025-10-07 11:00"
```

–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –≤—Ä–µ–º–µ–Ω–∏. –£–¥–æ–±–Ω–æ –ø—Ä–∏ —Ä–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–∏ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞.

```bash
journalctl -p err -b
```

–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è *error* –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∏—Å—Ç–µ–º—ã.

#### üîπ –ö–∞–∫ systemd —Å–≤—è–∑—ã–≤–∞–µ—Ç stdout/stderr —Å journald

–ö–æ–≥–¥–∞ —Å–µ—Ä–≤–∏—Å —Å—Ç–∞—Ä—Ç—É–µ—Ç —á–µ—Ä–µ–∑ systemd, PID –ø—Ä–æ—Ü–µ—Å—Å–∞ –ø—Ä–∏–∫—Ä–µ–ø–ª—è–µ—Ç—Å—è –∫ —Å–æ–∫–µ—Ç—É `/run/systemd/journal/stdout`.
–í—Å–µ –µ–≥–æ –ø–æ—Ç–æ–∫–∏ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—é—Ç—Å—è journald –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
–ü–∞—Ä–∞–º–µ—Ç—Ä—ã `StandardOutput=` –∏ `StandardError=` –∑–∞–¥–∞—é—Ç, –∫—É–¥–∞ –∏–º–µ–Ω–Ω–æ –ø–∏—Å–∞—Ç—å:
`inherit`, `journal`, `syslog`, `null` –∏–ª–∏ `kmsg`.

#### üîπ –ü—Ä–∏–º–µ—Ä –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ PID

```bash
journalctl _PID=1524
```

–ü–æ–∫–∞–∂–µ—Ç –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –æ—Ç —ç—Ç–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ ‚Äî —É–¥–æ–±–Ω–æ –¥–ª—è —Ä–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è ‚Äú–∑–æ–º–±–∏-—Å–µ—Ä–≤–∏—Å–æ–≤‚Äù.
---

### 5.3. –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–ª—å–∑–∞

Journald –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –≤—ã–≤–æ–¥ —Å–µ—Ä–≤–∏—Å–æ–≤ systemd: –≤—Å—ë, —á—Ç–æ –ø—Ä–æ–≥—Ä–∞–º–º–∞ –ø–∏—à–µ—Ç –≤ stdout –∏–ª–∏ stderr, –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –∂—É—Ä–Ω–∞–ª.
–ü–æ—ç—Ç–æ–º—É –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ **–Ω–µ –Ω—É–∂–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å —Ñ–∞–π–ª—ã –ª–æ–≥–æ–≤ –≤—Ä—É—á–Ω—É—é** ‚Äî systemd —Å–∞–º —Å–æ–±–∏—Ä–∞–µ—Ç –≤—Å—ë –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ.

**–ü—Ä–∏–º–µ—Ä:**
–Æ–Ω–∏—Ç `/etc/systemd/system/webapp.service`

```ini
[Service]
ExecStart=/usr/local/bin/webapp
Restart=always
StandardOutput=journal
StandardError=journal
```

–õ–æ–≥–∏ –º–æ–∂–Ω–æ –ø–æ—Ç–æ–º –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å:

```bash
journalctl -u webapp.service -f
```

---

### 5.4. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ journald

–§–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏: `/etc/systemd/journald.conf`

–ö–ª—é—á–µ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

```
[Journal]
Storage=persistent      # —Ö—Ä–∞–Ω–∏—Ç—å –ª–æ–≥–∏ –º–µ–∂–¥—É –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞–º–∏
SystemMaxUse=500M       # –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –æ–±—â–∏–π –æ–±—ä—ë–º
RuntimeMaxUse=100M      # –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –ø–∞–º—è—Ç—å –ø–æ–¥ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ª–æ–≥–∏
MaxFileSec=1month       # –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –≤–æ–∑—Ä–∞—Å—Ç —Ñ–∞–π–ª–∞
Compress=yes             # —Å–∂–∏–º–∞—Ç—å —Å—Ç–∞—Ä—ã–µ –∑–∞–ø–∏—Å–∏
```

–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π ‚Äî –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫:

```bash
systemctl restart systemd-journald
```

---

### 5.5. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è

journald —Ö—Ä–∞–Ω–∏—Ç –ª–æ–≥–∏ –≤ –±–∏–Ω–∞—Ä–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö (`/var/log/journal/<machine-id>/system.journal`).
–ö–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ:

* `_PID` ‚Äî –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ—Ü–µ—Å—Å–∞,
* `_UID` ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å,
* `_COMM` ‚Äî –∫–æ–º–∞–Ω–¥–∞,
* `_SYSTEMD_UNIT` ‚Äî —é–Ω–∏—Ç,
* `_EXE` ‚Äî –ø—É—Ç—å –∫ –∏—Å–ø–æ–ª–Ω—è–µ–º–æ–º—É —Ñ–∞–π–ª—É.

–≠—Ç–∏ –ø–æ–ª—è –ø–æ–∑–≤–æ–ª—è—é—Ç –¥–µ–ª–∞—Ç—å —Ç–æ—á–Ω—É—é —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é:

```bash
journalctl _UID=0 _SYSTEMD_UNIT=nginx.service
```

---

### 5.6. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è journald –∏ rsyslog

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é journald –º–æ–∂–µ—Ç –ø–µ—Ä–µ—Å—ã–ª–∞—Ç—å –ª–æ–≥–∏ –≤ rsyslog –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏:

```
ForwardToSyslog=yes
```

–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å—Ç—Ä–æ–∏—Ç—å –≥–∏–±—Ä–∏–¥–Ω—ã–µ —Å—Ö–µ–º—ã: journald —Å–æ–±–∏—Ä–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ, rsyslog –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–ª—å—à–µ –ø–æ TCP ‚Üí Fluentd ‚Üí ELK.

---

### 5.7. Best practices

1. **–û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–π —Ä–∞–∑–º–µ—Ä –∂—É—Ä–Ω–∞–ª–∞:**
   `SystemMaxUse=` –∏–ª–∏ `RuntimeMaxUse=`. –ò–Ω–∞—á–µ `/var` –º–æ–∂–Ω–æ –ø–µ—Ä–µ–ø–æ–ª–Ω–∏—Ç—å –∑–∞ –¥–µ–Ω—å –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–∞—Ö.
2. **–•—Ä–∞–Ω–∏ –ª–æ–≥–∏ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ:**
   –£—Å—Ç–∞–Ω–æ–≤–∏ `Storage=persistent`, –∏–Ω–∞—á–µ –æ–Ω–∏ –∏—Å—á–µ–∑–Ω—É—Ç –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏.
3. **–ù–µ —Å–æ—Ö—Ä–∞–Ω—è–π —Ñ–∞–π–ª—ã –≤—Ä—É—á–Ω—É—é –≤–Ω—É—Ç—Ä–∏ —Å–µ—Ä–≤–∏—Å–æ–≤ –ø–æ–¥ systemd.**
   Systemd —Å–∞–º –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç stdout/stderr.
4. **–ò—Å–ø–æ–ª—å–∑—É–π —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ —é–Ω–∏—Ç—É –∏ –≤—Ä–µ–º–µ–Ω–∏,** –∞ –Ω–µ –ø–æ grep ‚Äî —ç—Ç–æ –±—ã—Å—Ç—Ä–µ–µ –∏ –Ω–∞–¥—ë–∂–Ω–µ–µ.
5. **–û—Ç–ø—Ä–∞–≤–ª—è–π journald ‚Üí Fluent Bit ‚Üí Elasticsearch**, –µ—Å–ª–∏ –Ω—É–∂–Ω–∞ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞.

---


## üîß –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è

### –ó–∞–¥–∞–Ω–∏–µ 1. –ë–∞–∑–æ–≤–∞—è —Ä–∞–±–æ—Ç–∞ —Å –ª–æ–≥–∞–º–∏

–í—ã–≤–µ–¥–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 100 —Å—Ç—Ä–æ–∫ –∂—É—Ä–Ω–∞–ª–∞ —è–¥—Ä–∞ –∏ —Å–æ—Ö—Ä–∞–Ω–∏ –∏—Ö –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª.

```bash
journalctl -k -n 100 > kernel.log
```

### –ó–∞–¥–∞–Ω–∏–µ 2. Python-–ª–æ–≥–≥–µ—Ä

–°–æ–∑–¥–∞–π —Å–∫—Ä–∏–ø—Ç:

```python
import logging
logging.basicConfig(filename='app.log',
                    level=logging.INFO,
                    format='%(asctime)s %(levelname)s:%(message)s')
logging.info('–°–µ—Ä–≤–∏—Å —Å—Ç–∞—Ä—Ç–æ–≤–∞–ª')
logging.warning('–ü–∞–º—è—Ç—å –Ω–∞ –∏—Å—Ö–æ–¥–µ')
logging.error('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î')
```

–ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ —Ñ–∞–π–ª `app.log` —Å–æ–∑–¥–∞–ª—Å—è –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Ä–µ–º—è + —É—Ä–æ–≤–µ–Ω—å + —Å–æ–æ–±—â–µ–Ω–∏–µ.

### –ó–∞–¥–∞–Ω–∏–µ 3. –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ stdout/stderr

–°–æ–∑–¥–∞–π bash-—Å–∫—Ä–∏–ø—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø–∏—à–µ—Ç –≤ –æ–±–∞ –ø–æ—Ç–æ–∫–∞, –∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤—å –∏—Ö –≤ —Ä–∞–∑–Ω—ã–µ —Ñ–∞–π–ª—ã.

```bash
echo "ok"  
>&2 echo "error"  
```

---

## üìä –¢–µ—Å—Ç –¥–ª—è —Å–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫–∏

1. –ß–µ–º –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è stdout –æ—Ç stderr?
2. –ö–∞–∫–æ–π —É—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤—ã—à–µ ‚Äî INFO –∏–ª–∏ DEBUG?
3. –ß—Ç–æ –¥–µ–ª–∞–µ—Ç `journalctl -u ssh -f`?
4. –ü–æ—á–µ–º—É –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–æ–Ω—ã –≤–∞–∂–Ω—ã –≤ –ª–æ–≥–∞—Ö?
5. –ü–æ—á–µ–º—É —Ñ–æ—Ä–º–∞—Ç JSON —É–¥–æ–±–µ–Ω –¥–ª—è –∞–≥—Ä–µ–≥–∞—Ü–∏–∏?

---

## üß† Best Practices

1. –ò—Å–ø–æ–ª—å–∑—É–π **–æ–¥–∏–Ω —Ñ–æ—Ä–º–∞—Ç –ª–æ–≥–æ–≤** –≤–æ –≤—Å–µ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–µ.
2. –î–æ–±–∞–≤–ª—è–π **—Ç–∞–π–º–∑–æ–Ω—É –∏ UTC-–º–µ—Ç–∫—É** –≤ –∫–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ.
3. –ù–µ —Ö—Ä–∞–Ω–∏ –ª–æ–≥–∏ –≤ /var/log –¥–æ–ª–≥–æ ‚Äî –¥–µ–ª–∞–π —Ä–æ—Ç–∞—Ü–∏—é.
4. –ü–∏—à–∏ –ª–æ–≥–∏ –≤ stdout –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö ‚Äî –∏—Ö –∑–∞–±–µ—Ä—ë—Ç –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä.
5. –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä—É–π —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –¥–æ–±–∞–≤–ª—è–π –∫–ª—é—á–∏: `user_id`, `session`, `service`.

---

**–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –º–æ–¥—É–ª—è —Ç—ã —É–∂–µ –º–æ–∂–µ—à—å:**

* —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ª–æ–≥–∏;
* —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏ –≤ —Å–≤–æ–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö;
* –ø–æ–Ω–∏–º–∞—Ç—å, –∫–∞–∫ stdout/stderr –∏–¥—É—Ç –≤ –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä.

---


# **–ú–û–î–£–õ–¨ 2. –°–ò–°–¢–ï–ú–ù–û–ï –õ–û–ì–ò–†–û–í–ê–ù–ò–ï –° RSYSLOG**

### –¶–µ–ª—å

–û—Å–≤–æ–∏—Ç—å —Ä–∞–±–æ—Ç—É –¥–µ–º–æ–Ω–∞ **rsyslog**, –Ω–∞—É—á–∏—Ç—å—Å—è –ø—Ä–∏–Ω–∏–º–∞—Ç—å, —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –∏ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ª–æ–≥–∏ –Ω–∞ –¥—Ä—É–≥–∏–µ —É–∑–ª—ã.
–ü–æ—Å–ª–µ –º–æ–¥—É–ª—è —Ç—ã —Å–º–æ–∂–µ—à—å –ø–æ—Å—Ç—Ä–æ–∏—Ç—å —É—Å—Ç–æ–π—á–∏–≤—ã–π –±–∞–∑–æ–≤—ã–π –ª–æ–≥-–ø–∞–π–ø–ª–∞–π–Ω Linux-—Å–µ—Ä–≤–µ—Ä–∞.

---

## 1. –ß—Ç–æ —Ç–∞–∫–æ–µ rsyslog

**rsyslog** ‚Äî —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –¥–µ–º–æ–Ω —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ª–æ–≥–æ–≤, —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π —Å –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–º **syslog** (RFC 5424).
–û–Ω –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ç—Ä–∏ —Ä–æ–ª–∏:

1. –°–ª—É—à–∞–µ—Ç –≤—Ö–æ–¥—è—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç —è–¥—Ä–∞, systemd, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.
2. –§–∏–ª—å—Ç—Ä—É–µ—Ç –∏—Ö –ø–æ –ø—Ä–∞–≤–∏–ª–∞–º (facility, severity, source).
3. –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ –∏–ª–∏ –ø–µ—Ä–µ—Å—ã–ª–∞–µ—Ç –¥–∞–ª—å—à–µ ‚Äî –≤ —Ñ–∞–π–ª—ã, —Å–æ–∫–µ—Ç—ã, TCP, HTTP, Kafka –∏ —Ç. –¥.

---

## 2. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
Input  ‚Üí  Filter / Parser  ‚Üí  Queue  ‚Üí  Output
```

* **Input** ‚Äî –æ—Ç–∫—É–¥–∞ –ø—Ä–∏—Ö–æ–¥—è—Ç –ª–æ–≥–∏ (kernel, UDP, journald, imfile).
* **Filter/Parser** ‚Äî –ø–æ –∫–∞–∫–∏–º —É—Å–ª–æ–≤–∏—è–º –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å.
* **Queue** ‚Äî –æ—á–µ—Ä–µ–¥—å, –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—é—â–∞—è –¥–æ—Å—Ç–∞–≤–∫—É.
* **Output** ‚Äî –∫—É–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å (—Ñ–∞–π–ª, —É–¥–∞–ª—ë–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä, Elastic, Kafka).

–ú–æ–¥—É–ª–∏ rsyslog –ø–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è –¥–∏—Ä–µ–∫—Ç–∏–≤–æ–π `module(load="–∏–º—è")`.

---

## 3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è rsyslog

–û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª: `/etc/rsyslog.conf`
–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞: `/etc/rsyslog.d/*.conf`

–ö–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ ‚Äî –ø—Ä–∞–≤–∏–ª–æ:

```
facility.level   action
```

**–ü—Ä–∏–º–µ—Ä:**

```
authpriv.*    /var/log/secure
*.info;mail.none;authpriv.none;cron.none   /var/log/messages
```

* `facility` ‚Äî —Ç–∏–ø –∏—Å—Ç–æ—á–Ω–∏–∫–∞ (auth, daemon, cron, kern).
* `level` ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å (info, warn, err).
* `action` ‚Äî –∫—É–¥–∞ –ø–∏—Å–∞—Ç—å.

---

## 4. –û—Å–Ω–æ–≤–Ω—ã–µ facilities –∏ —É—Ä–æ–≤–Ω–∏

| Facility        | –ó–Ω–∞—á–µ–Ω–∏–µ                  |
| --------------- | ------------------------- |
| auth / authpriv | –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è            |
| cron            | –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞–Ω–∏–π       |
| daemon          | —Å–∏—Å—Ç–µ–º–Ω—ã–µ –¥–µ–º–æ–Ω—ã          |
| kern            | —è–¥—Ä–æ                      |
| mail            | –ø–æ—á—Ç–æ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã          |
| user            | –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã |

| –£—Ä–æ–≤–µ–Ω—å | –ß–∏—Å–ª–æ | –û–ø–∏—Å–∞–Ω–∏–µ                   |
| ------- | ----- | -------------------------- |
| emerg   | 0     | —Å–∏—Å—Ç–µ–º–∞ –Ω–µ—Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–∞   |
| alert   | 1     | –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è —Å–∏—Ç—É–∞—Ü–∏—è       |
| crit    | 2     | –æ—à–∏–±–∫–∞ —è–¥—Ä–∞ –∏–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è |
| err     | 3     | –æ–±—ã—á–Ω–∞—è –æ—à–∏–±–∫–∞             |
| warning | 4     | –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ             |
| notice  | 5     | –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ   |
| info    | 6     | –æ–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è           |
| debug   | 7     | –æ—Ç–ª–∞–¥–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ          |

---

## 5. –ü—Ä–∏–º–µ—Ä—ã –ø—Ä–∞–≤–∏–ª

### 5.1. –ó–∞–ø–∏—Å—å –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –æ–¥–∏–Ω —Ñ–∞–π–ª

```
*.*   /var/log/all.log
```

### 5.2. –ò—Å–∫–ª—é—á–∏—Ç—å –ø–æ—á—Ç—É –∏ cron

```
*.info;mail.none;cron.none   /var/log/messages
```

### 5.3. –†–∞–∑–¥–µ–ª–∏—Ç—å –ø–æ —É—Ä–æ–≤–Ω—è–º

```
*.err      /var/log/errors.log
*.warning  /var/log/warnings.log
```

### 5.4. –õ–æ–≥–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```
:programname, isequal, "nginx"  /var/log/nginx-rsyslog.log
```

### 5.5. –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ —É–¥–∞–ª—ë–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä

```
*.*  @@10.0.0.10:514
```

–û–¥–∏–Ω `@` ‚Äî UDP, –¥–≤–∞ `@@` ‚Äî TCP.

---

## 6. –ü—Ä–∏–Ω—è—Ç–∏–µ —É–¥–∞–ª—ë–Ω–Ω—ã—Ö –ª–æ–≥–æ–≤

### 6.1. –í–∫–ª—é—á–∞–µ–º –º–æ–¥—É–ª—å –∏ –ø–æ—Ä—Ç

```
module(load="imudp")
input(type="imudp" port="514")

module(load="imtcp")
input(type="imtcp" port="514")
```

### 6.2. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–∫–µ—Ç—ã

```bash
sudo ss -lnpt | grep rsyslog
```

### 6.3. –†–∞–∑—Ä–µ—à–∞–µ–º –≤ firewall

```bash
sudo ufw allow 514/tcp
sudo ufw allow 514/udp
```

–¢–µ–ø–µ—Ä—å —Å–µ—Ä–≤–µ—Ä –≥–æ—Ç–æ–≤ –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è —Å –¥—Ä—É–≥–∏—Ö –º–∞—à–∏–Ω.

---

## 7. –û—Ç–ø—Ä–∞–≤–∫–∞ –ª–æ–≥–æ–≤ —Å –∫–ª–∏–µ–Ω—Ç–∞

–ù–∞ –∫–ª–∏–µ–Ω—Ç–µ –¥–æ–±–∞–≤—å –≤ `/etc/rsyslog.d/90-remote.conf`:

```
*.*  @@logserver.example.com:514
```

–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ –¥–µ–º–æ–Ω:

```bash
systemctl restart rsyslog
```

–ü—Ä–æ–≤–µ—Ä–∫–∞:

```bash
logger "Test message from $(hostname)"
```

–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –ø–æ—è–≤–∏—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ `/var/log/all.log`.

---

## 8. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤

rsyslog –º–æ–∂–µ—Ç —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä–æ–∫–∏ –ø–µ—Ä–µ–¥ –∑–∞–ø–∏—Å—å—é:

```
template(name="jsonTemplate" type="list") {
  constant(value="{")
  constant(value="\"timestamp\":\"") property(name="timereported" dateFormat="rfc3339")
  constant(value="\",\"host\":\"") property(name="hostname")
  constant(value="\",\"message\":\"") property(name="msg")
  constant(value="\"}\n")
}
*.* action(type="omfile" file="/var/log/all.json" template="jsonTemplate")
```

‚Üí –õ–æ–≥–∏ –±—É–¥—É—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ JSON-–≤–∏–¥–µ ‚Äî —É–¥–æ–±–Ω–æ –¥–ª—è Fluent Bit/ELK.

---

## 9. –û—á–µ—Ä–µ–¥–∏ –∏ –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å

rsyslog –∏–º–µ–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –æ—á–µ—Ä–µ–¥–∏ –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏:

* **In-memory** ‚Äî –±—ã—Å—Ç—Ä–æ, –Ω–æ –¥–∞–Ω–Ω—ã–µ —Ç–µ—Ä—è—é—Ç—Å—è –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏.
* **Disk-assisted** ‚Äî —Ö—Ä–∞–Ω–∏—Ç –±—ç–∫–∞–ø –Ω–∞ –¥–∏—Å–∫–µ.
* **Disk** ‚Äî –ø–æ–ª–Ω–∞—è –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å.

**–ü—Ä–∏–º–µ—Ä:**

```
main_queue(
  type="LinkedList"
  fileName="mainq"
  maxDiskSpace="1g"
  queue.saveonshutdown="on"
)
```

---

## üîß –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è

### –ó–∞–¥–∞–Ω–∏–µ 1. –°–æ–±–µ—Ä–∏ –ª–æ–∫–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ –≤ –µ–¥–∏–Ω—ã–π —Ñ–∞–π–ª

–°–æ–∑–¥–∞–π `/etc/rsyslog.d/10-all.conf`:

```
*.*  /var/log/all.log
```

–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ rsyslog –∏ –ø—Ä–æ–≤–µ—Ä—å:

```bash
logger "test message"
tail -n 5 /var/log/all.log
```

### –ó–∞–¥–∞–Ω–∏–µ 2. –û—Ç–ø—Ä–∞–≤—å –ª–æ–≥–∏ –Ω–∞ —É–¥–∞–ª—ë–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä

1. –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ A –≤–∫–ª—é—á–∏ –ø—Ä–∏—ë–º TCP 514.
2. –ù–∞ –∫–ª–∏–µ–Ω—Ç–µ B –¥–æ–±–∞–≤—å —Å—Ç—Ä–æ–∫—É `*.* @@serverA:514`.
3. –ü—Ä–æ–≤–µ—Ä—å –ø–µ—Ä–µ–¥–∞—á—É —á–µ—Ä–µ–∑ `logger`.

### –ó–∞–¥–∞–Ω–∏–µ 3. –°–æ–∑–¥–∞–π JSON-—à–∞–±–ª–æ–Ω

1. –î–æ–±–∞–≤—å —à–∞–±–ª–æ–Ω –∏–∑ –ø—Ä–∏–º–µ—Ä–∞ –≤ –∫–æ–Ω—Ñ–∏–≥.
2. –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π –ø–∞—Ä—É —Å–æ–æ–±—â–µ–Ω–∏–π.
3. –£–±–µ–¥–∏—Å—å, —á—Ç–æ —Ñ–∞–π–ª `/var/log/all.json` –≤–∞–ª–∏–¥–µ–Ω (JSON Lint).

---

## üìä –¢–µ—Å—Ç –ø–æ –º–æ–¥—É–ª—é 2

1. –ö–∞–∫–æ–π –ø–æ—Ä—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è syslog –ø–æ TCP?
2. –ß–µ–º –æ—Ç–ª–∏—á–∞—é—Ç—Å—è –æ–¥–∏–Ω `@` –∏ –¥–≤–∞ `@@` –≤ –ø—Ä–∞–≤–∏–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏?
3. –ì–¥–µ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –Ω–∞—Å—Ç—Ä–æ–µ–∫ rsyslog?
4. –ß—Ç–æ —Ç–∞–∫–æ–µ facility –∏ severity?
5. –ö–∞–∫–∞—è –¥–∏—Ä–µ–∫—Ç–∏–≤–∞ –≤–∫–ª—é—á–∞–µ—Ç –ø—Ä–∏—ë–º UDP-—Å–æ–æ–±—â–µ–Ω–∏–π?

---

## üß† Best Practices

1. **–†–∞–∑–¥–µ–ª—è–π –ª–æ–≥–∏ –ø–æ —Ç–∏–ø–∞–º:** system, auth, app ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã.
2. **–ò—Å–ø–æ–ª—å–∑—É–π TCP –≤–º–µ—Å—Ç–æ UDP,** –µ—Å–ª–∏ –Ω—É–∂–Ω–∞ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞.
3. **–î–æ–±–∞–≤—å –æ—á–µ—Ä–µ–¥—å –Ω–∞ –¥–∏—Å–∫,** —á—Ç–æ–±—ã –Ω–µ —Ç–µ—Ä—è—Ç—å –ª–æ–≥–∏ –ø—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–∞—Ö.
4. **–•—Ä–∞–Ω–∏ –ª–æ–≥–∏ –≤ JSON,** –µ—Å–ª–∏ –ø–ª–∞–Ω–∏—Ä—É–µ—à—å –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –≤ Fluent Bit –∏–ª–∏ Elasticsearch.
5. **–ü—Ä–æ–≤–µ—Ä—è–π –ø—Ä–∞–≤–∞ –Ω–∞ /var/log/** ‚Äî –æ—à–∏–±–∫–∏ –ø—Ä–∞–≤ —á–∞—Å—Ç–æ –ø—Ä–∏–≤–æ–¥—è—Ç –∫ –º–æ–ª—á–∞–Ω–∏—é rsyslog.

---

**–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –º–æ–¥—É–ª—è —Ç—ã —É–∂–µ —É–º–µ–µ—à—å:**

* –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞—Ç—å rsyslog,
* —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏,
* –ø–µ—Ä–µ—Å—ã–ª–∞—Ç—å –∏—Ö –ø–æ TCP/UDP,
* —Å—Ç—Ä–æ–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –¥–ª—è –∞–≥—Ä–µ–≥–∞—Ü–∏–∏.

---


---

# **–ú–û–î–£–õ–¨ 3. FLUENTD –ò FLUENT BIT ‚Äî –°–û–í–†–ï–ú–ï–ù–ù–´–ô –°–ë–û–† –ò –ú–ê–†–®–†–£–¢–ò–ó–ê–¶–ò–Ø –õ–û–ì–û–í**

---

## üéØ –¶–µ–ª—å

–ù–∞—É—á–∏—Ç—å—Å—è —Å–æ–±–∏—Ä–∞—Ç—å, —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –∏ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –ª–æ–≥–∏ —Å —Å–µ—Ä–≤–µ—Ä–æ–≤, –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –≤ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ.
–ü–æ—Å–ª–µ –º–æ–¥—É–ª—è —Å—Ç—É–¥–µ–Ω—Ç —Å–º–æ–∂–µ—Ç —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –ø–∞–π–ø–ª–∞–π–Ω:
**Fluent Bit ‚Üí Fluentd ‚Üí Elasticsearch.**

---

## 1. –ß—Ç–æ —Ç–∞–∫–æ–µ Fluent Bit –∏ Fluentd

Fluentd ‚Äî —ç—Ç–æ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä –ª–æ–≥–æ–≤,
–∞ Fluent Bit ‚Äî –µ–≥–æ –º–ª–∞–¥—à–∏–π, –ª—ë–≥–∫–∏–π ‚Äú–∞–≥–µ–Ω—Ç‚Äù, –∫–æ—Ç–æ—Ä—ã–π —Å—Ç–æ–∏—Ç –±–ª–∏–∂–µ –∫ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º –¥–∞–Ω–Ω—ã—Ö.

–î—É–º–∞–π –æ –Ω–∏—Ö —Ç–∞–∫:

* **Fluent Bit** –∂–∏–≤—ë—Ç –Ω–∞ –∫–∞–∂–¥–æ–º —Å–µ—Ä–≤–µ—Ä–µ –∏ —Å–æ–±–∏—Ä–∞–µ—Ç –ª–æ–≥–∏ (–∏–∑ journald, —Ñ–∞–π–ª–æ–≤, docker).
* **Fluentd** –∂–∏–≤—ë—Ç –≤ —Ü–µ–Ω—Ç—Ä–µ (–Ω–∞ –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–º —É–∑–ª–µ) –∏ —Ä–µ—à–∞–µ—Ç, –∫—É–¥–∞ –≤—Å—ë —ç—Ç–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å ‚Äî Elasticsearch, Kafka, S3 –∏ —Ç.–¥.

| –ü–∞—Ä–∞–º–µ—Ç—Ä     | Fluent Bit                   | Fluentd                   |
| ------------ | ---------------------------- | ------------------------- |
| –¶–µ–ª—å         | —Å–±–æ—Ä –∏ –¥–æ—Å—Ç–∞–≤–∫–∞ –ª–æ–≥–æ–≤        | –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ |
| –ü–∞–º—è—Ç—å       | 5‚Äì10 –ú–ë                      | 50‚Äì100 –ú–ë                 |
| –Ø–∑—ã–∫         | C                            | Ruby                      |
| –ö–æ–Ω—Ñ–∏–≥       | `fluent-bit.conf`            | `fluent.conf`             |
| –ì–¥–µ —Å—Ç–∞–≤–∏—Ç—Å—è | –Ω–∞ –∫–∞–∂–¥–æ–º —Ö–æ—Å—Ç–µ / –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ | –≤ —Ü–µ–Ω—Ç—Ä–µ —Å—Ç–µ–∫–∞            |

> **Best practice:**
> –í –ø—Ä–æ–¥–∞–∫—à–Ω–µ –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π —Å–≤—è–∑–∫—É:
> **Fluent Bit** –∫–∞–∫ –∞–≥–µ–Ω—Ç ‚Üí **Fluentd** –∫–∞–∫ –ø—Ä–∏—ë–º–Ω–∏–∫ –∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä.

---

## 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### Fluent Bit (Ubuntu/Debian)

```bash
# –¥–æ–±–∞–≤–ª—è–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
curl https://packages.fluentbit.io/fluentbit.key | sudo apt-key add -

# –ø–æ–¥–∫–ª—é—á–∞–µ–º –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π apt-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
echo "deb https://packages.fluentbit.io/ubuntu/noble noble main" | sudo tee /etc/apt/sources.list.d/fluentbit.list

# —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–∞–∫–µ—Ç –∞–≥–µ–Ω—Ç–∞
sudo apt update && sudo apt install td-agent-bit
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**

1. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –∫–ª—é—á –ø–æ–¥–ø–∏—Å–∏ –ø–∞–∫–µ—Ç–æ–≤.
2. –î–æ–±–∞–≤–ª—è–µ—Ç—Å—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.
3. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –±–∏–Ω–∞—Ä–Ω–∏–∫ `td-agent-bit` –∏ —Å–æ–∑–¥–∞—ë—Ç—Å—è systemd-—Å–µ—Ä–≤–∏—Å.

---

### Fluentd (–∞–≥—Ä–µ–≥–∞—Ç–æ—Ä)

```bash
curl -L https://toolbelt.treasuredata.com/sh/install-ubuntu-jammy-td-agent4.sh | sudo sh
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç **td-agent** ‚Äî –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –ø–∞–∫–µ—Ç Fluentd.
–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–æ–∑–¥–∞—ë—Ç—Å—è –∫–æ–Ω—Ñ–∏–≥ `/etc/td-agent/td-agent.conf` –∏ —Å–µ—Ä–≤–∏—Å `td-agent.service`.

---

## 3. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Fluent Bit –∏ Fluentd

```
[INPUT] ‚Üí [FILTER] ‚Üí [BUFFER] ‚Üí [OUTPUT]
```

–ö–∞–∂–¥—ã–π –±–ª–æ–∫ –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–≤–æ—é –∑–∞–¥–∞—á—É:

* **INPUT** ‚Äî –ø–æ–ª—É—á–∞–µ—Ç –ª–æ–≥–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, tail ‚Äî —á–∏—Ç–∞–µ—Ç —Ñ–∞–π–ª—ã).
* **FILTER** ‚Äî –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç –∏–ª–∏ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —É–±–∏—Ä–∞–µ—Ç DEBUG).
* **BUFFER** ‚Äî –≤—Ä–µ–º–µ–Ω–Ω–æ —Ö—Ä–∞–Ω–∏—Ç –¥–∞–Ω–Ω—ã–µ (–≤ –ø–∞–º—è—Ç–∏ –∏–ª–∏ –Ω–∞ –¥–∏—Å–∫–µ).
* **OUTPUT** ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ –Ω—É–∂–Ω—É—é —Å–∏—Å—Ç–µ–º—É (stdout, Elasticsearch, Fluentd –∏ —Ç.–¥.).

---

## 4. –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ñ–∏–≥ Fluent Bit

**–§–∞–π–ª:** `/etc/fluent-bit/fluent-bit.conf`

```ini
[SERVICE]
    Flush        5
    Daemon       Off
    Log_Level    info
```

* `[SERVICE]` ‚Äî –æ–±—â–∏–π —Ä–∞–∑–¥–µ–ª –¥–ª—è –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∞–≥–µ–Ω—Ç–∞.
* `Flush 5` ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –¥–∞–Ω–Ω—ã–µ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥.
* `Daemon Off` ‚Äî —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ –ø–µ—Ä–µ–¥–Ω–µ–º –ø–ª–∞–Ω–µ (—É–¥–æ–±–Ω–æ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏).
* `Log_Level info` ‚Äî —É—Ä–æ–≤–µ–Ω—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è Fluent Bit.

---

```ini
[INPUT]
    Name         tail
    Path         /var/log/nginx/*.log
    Tag          nginx.*
```

* `[INPUT]` ‚Äî –∏—Å—Ç–æ—á–Ω–∏–∫ –ª–æ–≥–æ–≤.
* `Name tail` ‚Äî —Ç–∏–ø –≤—Ö–æ–¥–∞: **tail** —á–∏—Ç–∞–µ—Ç —Ñ–∞–π–ª—ã –ø–æ—Å—Ç—Ä–æ—á–Ω–æ (–∫–∞–∫ `tail -f`).
* `Path /var/log/nginx/*.log` ‚Äî –æ—Ç–∫—É–¥–∞ —á–∏—Ç–∞—Ç—å.
* `Tag nginx.*` ‚Äî —Ç–µ–≥ –Ω—É–∂–µ–Ω –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ (match –ø–æ —Ç–µ–≥—É).

---

```ini
[FILTER]
    Name         grep
    Match        nginx.*
    Regex        message .*error.*
```

* `[FILTER]` ‚Äî —Ñ–∏–ª—å—Ç—Ä—É—é—â–∏–π –±–ª–æ–∫.
* `Name grep` ‚Äî —Ñ–∏–ª—å—Ç—Ä ‚Äú–ø–æ —à–∞–±–ª–æ–Ω—É‚Äù (–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫–∏, –≥–¥–µ message —Å–æ–¥–µ—Ä–∂–∏—Ç ‚Äúerror‚Äù).
* `Match nginx.*` ‚Äî –ø—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä —Ç–æ–ª—å–∫–æ –∫ —Ç–µ–≥–∞–º nginx.
* `Regex message .*error.*` ‚Äî —Ä–µ–≥—É–ª—è—Ä–∫–∞ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏.

---

```ini
[OUTPUT]
    Name         stdout
    Match        *
```

* `[OUTPUT]` ‚Äî –∫—É–¥–∞ –≤—ã–≤–æ–¥–∏—Ç—å.
* `Name stdout` ‚Äî –ø–∏—Å–∞—Ç—å –Ω–∞ —ç–∫—Ä–∞–Ω (–≤ –∫–æ–Ω—Å–æ–ª—å).
* `Match *` ‚Äî –±—Ä–∞—Ç—å –≤—Å–µ —Ç–µ–≥–∏.

---

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
Fluent Bit –±—É–¥–µ—Ç –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥ —á–∏—Ç–∞—Ç—å –ª–æ–≥–∏ nginx, —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫–∏ –∏ –ø–µ—á–∞—Ç–∞—Ç—å –∏—Ö –≤ –∫–æ–Ω—Å–æ–ª—å.
–≠—Ç–æ –∏–¥–µ–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ä—Ç –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏.

---

## 5. Fluentd ‚Äî –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä

**–§–∞–π–ª:** `/etc/td-agent/td-agent.conf`

```conf
<source>
  @type forward
  port 24224
</source>
```

* `<source>` ‚Äî –≤—Ö–æ–¥–Ω–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫.
* `@type forward` ‚Äî –ø—Ä–∏—ë–º –¥–∞–Ω–Ω—ã—Ö –ø–æ –ø—Ä–æ—Ç–æ–∫–æ–ª—É Forward (–æ—Ç Fluent Bit).
* `port 24224` ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–æ—Ä—Ç –¥–ª—è —Å–≤—è–∑–∏ Bit ‚Üí Fluentd.

---

```conf
<match nginx.*>
  @type elasticsearch
  host 127.0.0.1
  port 9200
  logstash_format true
  include_tag_key true
  flush_interval 5s
</match>
```

* `<match nginx.*>` ‚Äî –≤—ã–±–∏—Ä–∞–µ—Ç –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å —Ç–µ–≥–æ–º `nginx.*`.
* `@type elasticsearch` ‚Äî –ø–æ–¥–∫–ª—é—á–∞–µ—Ç –ø–ª–∞–≥–∏–Ω –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Elasticsearch.
* `logstash_format true` ‚Äî —Å–æ–∑–¥–∞—ë—Ç –∏–Ω–¥–µ–∫—Å—ã –ø–æ –¥–∞—Ç–µ, –∫–∞–∫ —É Logstash (`fluentd-YYYY.MM.DD`).
* `flush_interval 5s` ‚Äî –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç –±—É—Ñ–µ—Ä –≤ Elasticsearch.

> ‚ö†Ô∏è –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ —É–±–µ–¥–∏—Å—å, —á—Ç–æ Elasticsearch —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚Äî –∏–Ω–∞—á–µ Fluentd –±—É–¥–µ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ —Ä–µ—Ç—Ä–∞–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É (–∏ –∑–∞—Å–æ—Ä–∏—Ç –ª–æ–≥–∏).

---

## 6. –ë—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è –∏ –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å

–ü—Ä–∏ –ø–µ—Ä–µ–±–æ—è—Ö —Å–µ—Ç—å –º–æ–∂–µ—Ç ‚Äú—Ä–≤–∞—Ç—å‚Äù –ø–æ—Ç–æ–∫ –ª–æ–≥–æ–≤.
Fluent Bit –∏ Fluentd —É–º–µ—é—Ç **–±—É—Ñ–µ—Ä–∏–∑–∏—Ä–æ–≤–∞—Ç—å** (–∑–∞–ø–æ–º–∏–Ω–∞—Ç—å) —Å–æ–æ–±—â–µ–Ω–∏—è –¥–æ —É—Å–ø–µ—à–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏.

---

### –ë—É—Ñ–µ—Ä Fluentd

```conf
<buffer>
  @type file
  path /var/log/td-agent/buffer
  flush_interval 10s
  retry_type exponential_backoff
</buffer>
```

* `@type file` ‚Äî —Ö—Ä–∞–Ω–∏—Ç—å –±—É—Ñ–µ—Ä –Ω–∞ –¥–∏—Å–∫–µ.
* `path` ‚Äî –∫–∞—Ç–∞–ª–æ–≥ –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤.
* `flush_interval 10s` ‚Äî —Å–±—Ä–∞—Å—ã–≤–∞—Ç—å –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥.
* `retry_type exponential_backoff` ‚Äî —É–≤–µ–ª–∏—á–∏–≤–∞—Ç—å –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –º–µ–∂–¥—É –ø–æ–≤—Ç–æ—Ä–∞–º–∏ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö (—á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∑–∏—Ç—å —Å–µ—Ç—å).

---

### –ë—É—Ñ–µ—Ä Fluent Bit

```ini
[OUTPUT]
    Name es
    Match *
    Host 127.0.0.1
    Port 9200
    Retry_Limit False
    storage.total_limit_size 512M
```

* `Retry_Limit False` ‚Äî –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ –ø—ã—Ç–∞—Ç—å—Å—è –¥–æ—Å—Ç–∞–≤–∏—Ç—å (–ø–æ–∫–∞ –Ω–µ –ø–æ–ª—É—á–∏—Ç—Å—è).
* `storage.total_limit_size 512M` ‚Äî –ª–∏–º–∏—Ç –¥–∏—Å–∫–æ–≤–æ–≥–æ –±—É—Ñ–µ—Ä–∞.

---

## 7. Routing –ø–æ —Ç–µ–≥–∞–º

Fluentd –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç –ø–æ—Ç–æ–∫–∏ –ø–æ —Ç–µ–≥–∞–º.
–ü—Ä–∏–º–µ—Ä:

```conf
<source>
  @type tail
  path /var/log/auth.log
  tag auth.*
</source>

<match auth.*>
  @type file
  path /var/log/central/auth.log
</match>
```

–ó–¥–µ—Å—å:

* –ò—Å—Ç–æ—á–Ω–∏–∫ `auth.log` –ø–æ–ª—É—á–∞–µ—Ç —Ç–µ–≥ `auth.*`.
* –í—Å–µ –∑–∞–ø–∏—Å–∏ —Å —ç—Ç–∏–º —Ç–µ–≥–æ–º –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ `/var/log/central/auth.log`.

–≠—Ç–æ –¥–∞—ë—Ç –≥–∏–±–∫–æ—Å—Ç—å ‚Äî –º–æ–∂–Ω–æ –æ–¥–Ω–∏–º Fluentd —É–ø—Ä–∞–≤–ª—è—Ç—å –ª–æ–≥–∞–º–∏ –¥–µ—Å—è—Ç–∫–æ–≤ —Å–µ—Ä–≤–∏—Å–æ–≤.

---

## 8. –ü–∞—Ä—Å–∏–Ω–≥ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ

Fluentd —É–º–µ–µ—Ç –ø—Ä–µ–≤—Ä–∞—â–∞—Ç—å —Å—ã—Ä—ã–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å—Ç—Ä–æ–∫–∏ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ JSON-–∑–∞–ø–∏—Å–∏.

### Regex-–ø—Ä–∏–º–µ—Ä

```conf
<parse>
  @type regexp
  expression /(?<ip>\d+\.\d+\.\d+\.\d+) .* "(?<method>[A-Z]+) (?<path>[^"]+)"/
  time_format %d/%b/%Y:%H:%M:%S %z
</parse>
```

* `expression` ‚Äî —Ä–µ–≥—É–ª—è—Ä–∫–∞ —Å –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–º–∏ –≥—Ä—É–ø–ø–∞–º–∏ (`?<ip>`, `?<method>`).
* `time_format` ‚Äî —à–∞–±–ª–æ–Ω –≤—Ä–µ–º–µ–Ω–∏ –∏–∑ —Å—Ç—Ä–æ–∫–∏.

–†–µ–∑—É–ª—å—Ç–∞—Ç:

```json
{
  "ip": "192.168.1.10",
  "method": "GET",
  "path": "/index.html"
}
```

### JSON-–ø—Ä–∏–º–µ—Ä

–ï—Å–ª–∏ –ª–æ–≥–∏ —É–∂–µ –≤ JSON:

```conf
<parse>
  @type json
</parse>
```

Fluentd –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–µ—Ç –∏ –¥–æ–±–∞–≤–∏—Ç –ø–æ–ª—è –≤ –∏–Ω–¥–µ–∫—Å.

---

## 9. –°–±–æ—Ä –ª–æ–≥–æ–≤ –∏–∑ Docker –∏ systemd

### Docker

```ini
[INPUT]
    Name  tail
    Path  /var/lib/docker/containers/*/*.log
    Parser docker
    Tag docker.*
```

* `Parser docker` ‚Äî –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –ø–∞—Ä—Å–µ—Ä –¥–ª—è JSON-–ª–æ–≥–æ–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤.
* `Tag docker.*` ‚Äî –ø–æ–º–µ—á–∞–µ–º –≤—Å—ë, —á—Ç–æ –ø—Ä–∏—à–ª–æ –æ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤.

### journald

```ini
[INPUT]
    Name  systemd
    Tag   host.*
    Systemd_Filter _SYSTEMD_UNIT=nginx.service
```

* `Name systemd` ‚Äî –≤—Ö–æ–¥–Ω–æ–π –ø–ª–∞–≥–∏–Ω –¥–ª—è `journald`.
* `Systemd_Filter` ‚Äî —Ñ–∏–ª—å—Ç—Ä –ø–æ —é–Ω–∏—Ç—É (–∑–¥–µ—Å—å nginx).

---

## 10. –°–≤—è–∑–∫–∞ Fluent Bit ‚Üí Fluentd

### –ö–æ–Ω—Ñ–∏–≥ –Ω–∞ –∞–≥–µ–Ω—Ç–µ (Fluent Bit)

```ini
[OUTPUT]
    Name  forward
    Match *
    Host  log-aggregator
    Port  24224
```

* `Name forward` ‚Äî –≤—ã—Ö–æ–¥–Ω–æ–π –ø–ª–∞–≥–∏–Ω, –æ—Ç–ø—Ä–∞–≤–ª—è—é—â–∏–π –¥–∞–Ω–Ω—ã–µ –ø–æ TCP –Ω–∞ Fluentd.
* `Host log-aggregator` ‚Äî IP –∏–ª–∏ hostname –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä–∞.
* `Port 24224` ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–æ—Ä—Ç Fluentd.

---

### –ö–æ–Ω—Ñ–∏–≥ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (Fluentd)

```conf
<source>
  @type forward
  port 24224
</source>

<match **>
  @type stdout
</match>
```

Fluentd –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ø–æ—Ç–æ–∫ –∏ –ø–µ—á–∞—Ç–∞–µ—Ç –≤—Å—ë –Ω–∞ —ç–∫—Ä–∞–Ω ‚Äî —É–¥–æ–±–Ω–æ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ —Å–≤—è–∑–∫–∏.
–ï—Å–ª–∏ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç ‚Äî –º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å `stdout` –Ω–∞ `elasticsearch` –∏–ª–∏ `file`.

---

## üîß –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è

### –ó–∞–¥–∞–Ω–∏–µ 1. –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø–∞–π–ø–ª–∞–π–Ω

–ù–∞—Å—Ç—Ä–æ–π Fluent Bit, —á—Ç–æ–±—ã:

* —á–∏—Ç–∞—Ç—å `/var/log/syslog`,
* —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å `error`,
* –ø–µ—á–∞—Ç–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ stdout.

### –ó–∞–¥–∞–Ω–∏–µ 2. –°–≤—è–∑–∫–∞ Bit ‚Üí Fluentd ‚Üí Elasticsearch

1. –ü–æ–¥–Ω–∏–º–∏ –ª–æ–∫–∞–ª—å–Ω–æ Elasticsearch (–º–æ–∂–Ω–æ —á–µ—Ä–µ–∑ docker).
2. –ù–∞—Å—Ç—Ä–æ–π Fluent Bit –∫–∞–∫ –∞–≥–µ–Ω—Ç.
3. –ù–∞—Å—Ç—Ä–æ–π Fluentd –∫–∞–∫ –ø—Ä–∏—ë–º–Ω–∏–∫ (`@type elasticsearch`).
4. –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –≤ Kibana –ø–æ—è–≤–∏–ª–∏—Å—å –ª–æ–≥–∏ nginx.

### –ó–∞–¥–∞–Ω–∏–µ 3. Journald ‚Üí Fluent Bit

1. –ü–æ–¥–∫–ª—é—á–∏ –≤—Ö–æ–¥ `systemd`.
2. –§–∏–ª—å—Ç—Ä—É–π `_SYSTEMD_UNIT=sshd.service`.
3. –í—ã–≤–µ–¥–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ —Ñ–∞–π–ª `/var/log/sshd-fluent.log`.

---

## üìä –¢–µ—Å—Ç

1. –ß–µ–º Fluent Bit –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç Fluentd?
2. –ß—Ç–æ –¥–µ–ª–∞–µ—Ç –¥–∏—Ä–µ–∫—Ç–∏–≤–∞ `Match *`?
3. –ö–∞–∫ –≤–∫–ª—é—á–∏—Ç—å –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—é –Ω–∞ –¥–∏—Å–∫–µ?
4. –ù–∞ –∫–∞–∫–æ–º –ø–æ—Ä—Ç—É Fluentd –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ?
5. –ö–∞–∫–æ–π –ø–ª–∞–≥–∏–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–±–æ—Ä–∞ –ª–æ–≥–æ–≤ journald?

---

## üß† Best Practices

1. **Fluent Bit ‚Üí Fluentd** ‚Äî –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω–∞—è —Å—Ö–µ–º–∞.
2. **JSON –∫–∞–∫ —Å—Ç–∞–Ω–¥–∞—Ä—Ç —Ñ–æ—Ä–º–∞—Ç–∞.** –ï—Å–ª–∏ –º–æ–∂–µ—à—å ‚Äî –ª–æ–≥–∏—Ä—É–π –≤ JSON.
3. **–î–∏—Å–∫–æ–≤—ã–π –±—É—Ñ–µ—Ä –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω** –≤ –ø—Ä–æ–¥–∞–∫—à–Ω–µ.
4. **–ò—Å–ø–æ–ª—å–∑—É–π TLS –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é** –º–µ–∂–¥—É –∞–≥–µ–Ω—Ç–æ–º –∏ —Å–µ—Ä–≤–µ—Ä–æ–º.
5. **–¢–µ—Å—Ç–∏—Ä—É–π regex-–ø–∞—Ä—Å–µ—Ä—ã –Ω–∞ edge-—Å–µ—Ä–≤–µ—Ä–µ,** —á—Ç–æ–±—ã –Ω–µ –ª–æ–º–∞—Ç—å –ø—Ä–æ–¥–∞–∫—à–Ω-–∞–≥—Ä–µ–≥–∞—Ç–æ—Ä.
6. **–ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–π flush_interval.** –°–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π ‚Äî –Ω–∞–≥—Ä—É–∂–∞–µ—Ç —Å–µ—Ç—å, —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π ‚Äî –∑–∞–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ª–æ–≥–∏.

---

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –º–æ–¥—É–ª—è —Ç—ã:

* –ü–æ–Ω–∏–º–∞–µ—à—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É —Å–±–æ—Ä–∞ –ª–æ–≥–æ–≤.
* –ú–æ–∂–µ—à—å –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å Fluent Bit –∏ Fluentd.
* –†–∞–∑–±–∏—Ä–∞–µ—à—å –∏ —Ñ–∏–ª—å—Ç—Ä—É–µ—à—å –ª–æ–≥–∏ –∏–∑ journald, —Ñ–∞–π–ª–æ–≤ –∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤.
* –ú–æ–∂–µ—à—å –ø–æ—Å—Ç—Ä–æ–∏—Ç—å —Ä–∞–±–æ—á–∏–π –ø–∞–π–ø–ª–∞–π–Ω –¥–æ Elasticsearch.

---

# **–ú–û–î–£–õ–¨ 4. –•–†–ê–ù–ï–ù–ò–ï –ò –ò–ù–î–ï–ö–°–ê–¶–ò–Ø –õ–û–ì–û–í –í ELASTICSEARCH**

---

## üéØ –¶–µ–ª—å

–ü–æ–Ω—è—Ç—å, –∫–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω Elasticsearch, –Ω–∞—É—á–∏—Ç—å—Å—è —Ö—Ä–∞–Ω–∏—Ç—å, –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞—Ç—å –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –∏—Å–∫–∞—Ç—å –º–∏–ª–ª–∏–æ–Ω—ã –ª–æ–≥–æ–≤ –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.
–ü–æ—Å–ª–µ –º–æ–¥—É–ª—è —Ç—ã —Å–º–æ–∂–µ—à—å —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –ª–æ–≥–æ–≤ —É—Ä–æ–≤–Ω—è production.

---

## 1. –ß—Ç–æ —Ç–∞–∫–æ–µ Elasticsearch

**Elasticsearch (ES)** ‚Äî —ç—Ç–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–∞—è –ø–æ–∏—Å–∫–æ–≤–∞—è –∏ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞, –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–æ–¥ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.

–ö–æ–≥–¥–∞ Fluentd –∏–ª–∏ Fluent Bit –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç –ª–æ–≥–∏ –≤ ES, –æ–Ω–∏ –ø—Ä–µ–≤—Ä–∞—â–∞—é—Ç—Å—è –≤ –¥–æ–∫—É–º–µ–Ω—Ç—ã JSON, –∫–æ—Ç–æ—Ä—ã–µ –∏–Ω–¥–µ–∫—Å–∏—Ä—É—é—Ç—Å—è ‚Äî —Ç–æ –µ—Å—Ç—å —Ä–∞–∑–±–∏–≤–∞—é—Ç—Å—è –Ω–∞ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞.

–õ–æ–≥–∏—á–µ—Å–∫–∏ Elasticsearch —Å–æ—Å—Ç–æ–∏—Ç –∏–∑:

* **Cluster** ‚Äî —Å–æ–≤–æ–∫—É–ø–Ω–æ—Å—Ç—å –≤—Å–µ—Ö —É–∑–ª–æ–≤.
* **Node** ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä —Å —Ä–æ–ª—å—é (data, master, ingest).
* **Index** ‚Äî ‚Äú—Ç–∞–±–ª–∏—Ü–∞‚Äù –¥–∞–Ω–Ω—ã—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, `nginx-logs-2025.10.07`).
* **Shard** ‚Äî –∫—É—Å–æ—á–µ–∫ –∏–Ω–¥–µ–∫—Å–∞, —Ñ–∏–∑–∏—á–µ—Å–∫–∏ —Ö—Ä–∞–Ω—è—â–∏–π—Å—è –Ω–∞ –¥–∏—Å–∫–µ.
* **Replica** ‚Äî –∫–æ–ø–∏—è —à–∞—Ä–¥–æ–≤ –¥–ª—è –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏.

---

## 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Elasticsearch (–æ–¥–∏–Ω–æ—á–Ω—ã–π —É–∑–µ–ª)

–î–ª—è –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π —Å—Ä–µ–¥—ã:

```bash
# 1. –°–∫–∞—á–∞—Ç—å –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Elasticsearch
wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-8.14.0-amd64.deb
sudo dpkg -i elasticsearch-8.14.0-amd64.deb

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å
sudo systemctl enable elasticsearch
sudo systemctl start elasticsearch
```

–ü—Ä–æ–≤–µ—Ä–∫–∞:

```bash
curl -k -u elastic:–ø–∞—Ä–æ–ª—å https://localhost:9200
```

–ï—Å–ª–∏ –≤—Å—ë –æ–∫ ‚Äî —É–≤–∏–¥–∏—à—å JSON —Å –≤–µ—Ä—Å–∏–µ–π –∫–ª–∞—Å—Ç–µ—Ä–∞.

---

## 3. –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (elasticsearch.yml)

–§–∞–π–ª: `/etc/elasticsearch/elasticsearch.yml`

```yaml
cluster.name: logs-cluster
node.name: node-1
network.host: 0.0.0.0
http.port: 9200
discovery.type: single-node
path.data: /var/lib/elasticsearch
path.logs: /var/log/elasticsearch
xpack.security.enabled: false
```

**–ß—Ç–æ —ç—Ç–æ –∑–Ω–∞—á–∏—Ç:**

* `cluster.name` ‚Äî –∏–º—è –∫–ª–∞—Å—Ç–µ—Ä–∞, –ø–æ–¥ –∫–æ—Ç–æ—Ä—ã–º —Å–æ–µ–¥–∏–Ω—è—é—Ç—Å—è —É–∑–ª—ã.
* `node.name` ‚Äî –∏–º—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —É–∑–ª–∞ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ Kibana).
* `network.host` ‚Äî –∞–¥—Ä–µ—Å, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º —Å–ª—É—à–∞–µ—Ç API.
* `discovery.type: single-node` ‚Äî –æ–¥–∏–Ω–æ—á–Ω—ã–π —Ä–µ–∂–∏–º (–±–µ–∑ –º–∞—Å—Ç–µ—Ä–æ–≤).
* `xpack.security.enabled: false` ‚Äî –æ—Ç–∫–ª—é—á–∞–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏–∏.

> ‚ö†Ô∏è –í –ø—Ä–æ–¥–∞–∫—à–Ω–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –≤–∫–ª—é—á–∞–µ—Ç—Å—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ: —Å TLS –∏ API-—Ç–æ–∫–µ–Ω–∞–º–∏.

---

## 4. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏–Ω–¥–µ–∫—Å–æ–≤ –∏ rollover

–ö–∞–∂–¥—ã–π –∏–Ω–¥–µ–∫—Å —Å–æ–¥–µ—Ä–∂–∏—Ç –º–∏–ª–ª–∏–æ–Ω—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.
–î–ª—è –ª–æ–≥–æ–≤ –ø—Ä–∏–Ω—è—Ç–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å **–¥–Ω–µ–≤–Ω—ã–µ –∏–ª–∏ –Ω–µ–¥–µ–ª—å–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã**, —á—Ç–æ–±—ã:

* –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞—Ç—å –æ–¥–∏–Ω –∏–Ω–¥–µ–∫—Å,
* –ª–µ–≥–∫–æ —É–¥–∞–ª—è—Ç—å —Å—Ç–∞—Ä—ã–µ,
* —É–ø—Ä–∞–≤–ª—è—Ç—å retention (—Å—Ä–æ–∫–æ–º —Ö—Ä–∞–Ω–µ–Ω–∏—è).

–ü—Ä–∏–º–µ—Ä –∏–º–µ–Ω–∏:

```
logs-nginx-2025.10.07
```

**Rollover policy** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞, –∫–æ–≥–¥–∞ —Å—Ç–∞—Ä—ã–π –¥–æ—Å—Ç–∏–≥–∞–µ—Ç –ª–∏–º–∏—Ç–∞.

**–ü—Ä–∏–º–µ—Ä –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**

```json
PUT _ilm/policy/logs-policy
{
  "policy": {
    "phases": {
      "hot": {
        "actions": {
          "rollover": {
            "max_age": "7d",
            "max_size": "5gb"
          }
        }
      },
      "delete": {
        "min_age": "30d",
        "actions": { "delete": {} }
      }
    }
  }
}
```

* `hot` ‚Äî –∞–∫—Ç–∏–≤–Ω—ã–π –∏–Ω–¥–µ–∫—Å (–ø—Ä–∏—ë–º –ª–æ–≥–æ–≤).
* `rollover` ‚Äî —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—ã–π –∫–∞–∂–¥—ã–µ 7 –¥–Ω–µ–π –∏–ª–∏ –ø—Ä–∏ 5 –ì–ë.
* `delete` ‚Äî —É–¥–∞–ª—è–µ—Ç —Å—Ç–∞—Ä—ã–µ —á–µ—Ä–µ–∑ 30 –¥–Ω–µ–π.

---

## 5. Mapping –∏ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä—ã

**Mapping** ‚Äî —ç—Ç–æ ‚Äú—Å—Ö–µ–º–∞‚Äù –∏–Ω–¥–µ–∫—Å–∞: –∫–∞–∫–∏–µ –ø–æ–ª—è –µ—Å—Ç—å –∏ –∫–∞–∫–æ–≥–æ –æ–Ω–∏ —Ç–∏–ø–∞.
ES –º–æ–∂–µ—Ç —Å–∞–º –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–∏–ø—ã, –Ω–æ –ª—É—á—à–µ –∑–∞–¥–∞–≤–∞—Ç—å —è–≤–Ω–æ.

```json
PUT logs-nginx
{
  "mappings": {
    "properties": {
      "timestamp": { "type": "date" },
      "level":      { "type": "keyword" },
      "service":    { "type": "keyword" },
      "message":    { "type": "text" },
      "ip":         { "type": "ip" },
      "user_id":    { "type": "integer" }
    }
  }
}
```

* `keyword` ‚Äî –ø–æ–ª–µ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ (—Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ).
* `text` ‚Äî –ø–æ–ª–µ –¥–ª—è –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞.
* `date`, `ip`, `integer` ‚Äî —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–∏–ø—ã.

> **Best practice:**
> –ò—Å–ø–æ–ª—å–∑—É–π `keyword` –¥–ª—è –ø–æ–ª–µ–π —É—Ä–æ–≤–Ω—è (`INFO`, `ERROR`, `service`), –∞ `text` ‚Äî —Ç–æ–ª—å–∫–æ –¥–ª—è `message`. –≠—Ç–æ —ç–∫–æ–Ω–æ–º–∏—Ç RAM –∏ —É—Å–∫–æ—Ä—è–µ—Ç —Ñ–∏–ª—å—Ç—Ä—ã.

---

## 6. –ó–∞–≥—Ä—É–∑–∫–∞ –ª–æ–≥–æ–≤ –≤—Ä—É—á–Ω—É—é (–ø—Ä–∏–º–µ—Ä)

–°–æ–∑–¥–∞–¥–∏–º —Ç–µ—Å—Ç–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç:

```bash
curl -X POST "localhost:9200/logs-nginx/_doc" -H 'Content-Type: application/json' -d '{
  "timestamp": "2025-10-07T10:33:21Z",
  "level": "ERROR",
  "service": "nginx",
  "message": "Upstream connection timed out",
  "ip": "192.168.1.10"
}'
```

–ü—Ä–æ–≤–µ—Ä–∏–º:

```bash
curl "localhost:9200/logs-nginx/_search?q=service:nginx"
```

---

## 7. –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è

Elasticsearch –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —è–∑—ã–∫ –∑–∞–ø—Ä–æ—Å–æ–≤ DSL.
–ü—Ä–∏–º–µ—Ä –ø—Ä–æ—Å—Ç–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞:

```json
POST logs-nginx/_search
{
  "query": {
    "bool": {
      "must": [
        { "match": { "level": "ERROR" }},
        { "range": { "timestamp": { "gte": "now-1h" }}}
      ]
    }
  },
  "sort": [{ "timestamp": "desc" }]
}
```

‚Üí –ü–æ–∫–∞–∂–µ—Ç –≤—Å–µ –æ—à–∏–±–∫–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å, –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ –≤—Ä–µ–º–µ–Ω–∏.

---

## 8. –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è —á–µ—Ä–µ–∑ Fluentd

–ß—Ç–æ–±—ã Fluentd –ø–∏—Å–∞–ª –ª–æ–≥–∏ –≤ Elasticsearch, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–ª–∞–≥–∏–Ω `@type elasticsearch`.

```conf
<match **>
  @type elasticsearch
  host 127.0.0.1
  port 9200
  logstash_format true
  include_tag_key true
  flush_interval 5s
</match>
```

**–†–∞–∑–±–æ—Ä:**

* `logstash_format true` ‚Äî —Å–æ–∑–¥–∞—ë—Ç –∏–Ω–¥–µ–∫—Å—ã –≤–∏–¥–∞ `fluentd-YYYY.MM.DD`.
* `include_tag_key true` ‚Äî –¥–æ–±–∞–≤–ª—è–µ—Ç —Ç–µ–≥ –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ.
* `flush_interval` ‚Äî —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç –±—É—Ñ–µ—Ä –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥.

---

## 9. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–ª–∞—Å—Ç–µ—Ä–∞

–û—Å–Ω–æ–≤–Ω—ã–µ API:

```bash
# –æ–±—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
curl -X GET "localhost:9200/_cluster/health?pretty"

# —Å–ø–∏—Å–æ–∫ –∏–Ω–¥–µ–∫—Å–æ–≤
curl -X GET "localhost:9200/_cat/indices?v"

# –ø—Ä–æ–≤–µ—Ä–∫–∞ —à–∞—Ä–¥–æ–≤
curl -X GET "localhost:9200/_cat/shards?v"
```

**–¢–∏–ø–∏—á–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è:**

* `green` ‚Äî –≤—Å—ë –æ—Ç–ª–∏—á–Ω–æ.
* `yellow` ‚Äî –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç —Ä–µ–ø–ª–∏–∫–∏, –Ω–æ –¥–∞–Ω–Ω—ã–µ –µ—Å—Ç—å.
* `red` ‚Äî —à–∞—Ä–¥–æ–≤ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç, –≤–æ–∑–º–æ–∂–Ω–∞ –ø–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö.

---

## 10. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ö—Ä–∞–Ω–µ–Ω–∏—è

1. **Hot-warm-cold –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**

   * hot ‚Äî –∞–∫—Ç–∏–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ;
   * warm ‚Äî —Å—Ç–∞—Ä—ã–µ, –Ω–æ –¥–æ—Å—Ç—É–ø–Ω—ã–µ;
   * cold ‚Äî –∞—Ä—Ö–∏–≤ (S3, Glacier).
     –ü—Ä–∏–º–µ—Ä: –∑–∞ 7 –¥–Ω–µ–π –¥–∞–Ω–Ω—ã–µ ‚Äú–æ—Å—Ç—ã–≤–∞—é—Ç‚Äù –∏ –ø–µ—Ä–µ–Ω–æ—Å—è—Ç—Å—è –Ω–∞ –¥–µ—à—ë–≤—ã–µ —É–∑–ª—ã.

2. **–°–∂–∞—Ç–∏–µ –∏ refresh**
   –£–º–µ–Ω—å—à–∞–π `refresh_interval` –¥–æ 30‚Äì60s (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1s), —á—Ç–æ–±—ã —Å–æ–∫—Ä–∞—Ç–∏—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É.

   ```
   PUT logs-nginx/_settings
   {
     "index": { "refresh_interval": "30s" }
   }
   ```

3. **–£–¥–∞–ª—è–π —Å—Ç–∞—Ä—ã–µ –∏–Ω–¥–µ–∫—Å—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** (—Å–º. ILM policy –≤—ã—à–µ).

---

## üîß –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è

### –ó–∞–¥–∞–Ω–∏–µ 1. –†–∞–∑–≤–µ—Ä–Ω–∏ Elasticsearch –∏ —Å–æ–∑–¥–∞–π –∏–Ω–¥–µ–∫—Å

1. –£—Å—Ç–∞–Ω–æ–≤–∏ ES –∏ –∑–∞–ø—É—Å—Ç–∏ –µ–≥–æ.
2. –°–æ–∑–¥–∞–π –∏–Ω–¥–µ–∫—Å `logs-test` —Å –ø–æ–ª—è–º–∏ `timestamp`, `level`, `message`.
3. –û—Ç–ø—Ä–∞–≤—å 3 —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–∞.
4. –°–¥–µ–ª–∞–π –ø–æ–∏—Å–∫ –ø–æ —É—Ä–æ–≤–Ω—é `ERROR`.

### –ó–∞–¥–∞–Ω–∏–µ 2. –ü–æ–¥–∫–ª—é—á–∏ Fluentd ‚Üí Elasticsearch

1. –ù–∞—Å—Ç—Ä–æ–π Fluentd —Å `@type elasticsearch`.
2. –û—Ç–ø—Ä–∞–≤—å –ª–æ–≥–∏ nginx.
3. –£–±–µ–¥–∏—Å—å, —á—Ç–æ –∏–Ω–¥–µ–∫—Å `fluentd-*` –ø–æ—è–≤–∏–ª—Å—è.

### –ó–∞–¥–∞–Ω–∏–µ 3. –ù–∞—Å—Ç—Ä–æ–π rollover policy

1. –°–æ–∑–¥–∞–π ILM-–ø–æ–ª–∏—Ç–∏–∫—É —Å rollover –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç (–¥–ª—è —Ç–µ—Å—Ç–∞).
2. –ù–∞–±–ª—é–¥–∞–π, –∫–∞–∫ —Å–æ–∑–¥–∞—é—Ç—Å—è –Ω–æ–≤—ã–µ –∏–Ω–¥–µ–∫—Å—ã.
3. –ü—Ä–æ–≤–µ—Ä—å —É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö —á–µ—Ä–µ–∑ `DELETE`.

---

## üìä –¢–µ—Å—Ç –ø–æ –º–æ–¥—É–ª—é 4

1. –ß—Ç–æ —Ç–∞–∫–æ–µ shard –∏ replica –≤ Elasticsearch?
2. –î–ª—è —á–µ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è mapping?
3. –ß—Ç–æ –¥–µ–ª–∞–µ—Ç rollover policy?
4. –ö–∞–∫ –∏–∑–º–µ–Ω–∏—Ç—å –≤—Ä–µ–º—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω–¥–µ–∫—Å–∞?
5. –ü–æ—á–µ–º—É `keyword` –ª—É—á—à–µ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏, —á–µ–º `text`?

---

## üß† Best Practices

1. **–î–Ω–µ–≤–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã** ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è –ª–æ–≥–æ–≤, –Ω–µ–¥–µ–ª—å–Ω—ã–µ ‚Äî –¥–ª—è –∞—Ä—Ö–∏–≤–æ–≤.
2. **–•—Ä–∞–Ω–∏ –Ω–µ –±–æ–ª—å—à–µ 30‚Äì90 –¥–Ω–µ–π** –¥–∞–Ω–Ω—ã—Ö –≤ –≥–æ—Ä—è—á–µ–º –∫–ª–∞—Å—Ç–µ—Ä–µ.
3. **–ò—Å–ø–æ–ª—å–∑—É–π –ø–æ–ª—è —Ç–∏–ø–∞ keyword** –¥–ª—è –º–µ—Ç–æ–∫, –∞ –Ω–µ text.
4. **–°–ª–µ–¥–∏ –∑–∞ refresh_interval** ‚Äî —á–∞—Å—Ç—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —É–±–∏–≤–∞—é—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å.
5. **–í–∫–ª—é—á–∞–π —Ä–µ–ø–ª–∏–∫–∏** (1 –º–∏–Ω–∏–º—É–º) ‚Äî —Å–ø–∞—Å—É—Ç –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ —É–∑–ª–∞.
6. **–ù–µ –ø–∏—à–∏ –Ω–∞–ø—Ä—è–º—É—é –≤ –æ–¥–∏–Ω –∏–Ω–¥–µ–∫—Å –≥–æ–¥–∞–º–∏.** –ò—Å–ø–æ–ª—å–∑—É–π rollover.

---

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –º–æ–¥—É–ª—è —Ç—ã —É–º–µ–µ—à—å:

* —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å Elasticsearch;
* —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏–Ω–¥–µ–∫—Å—ã –∏ mapping;
* –≤—ã–ø–æ–ª–Ω—è—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é;
* –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å rollover –∏ ILM –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ö—Ä–∞–Ω–µ–Ω–∏–µ–º;
* –ø—Ä–∏–Ω–∏–º–∞—Ç—å –ª–æ–≥–∏ –æ—Ç Fluentd –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.

---

# **–ú–û–î–£–õ–¨ 5. –í–ò–ó–£–ê–õ–ò–ó–ê–¶–ò–Ø –ò –ê–ù–ê–õ–ò–ó –õ–û–ì–û–í (KIBANA / GRAFANA)**

---

## üéØ –¶–µ–ª—å

–ù–∞—É—á–∏—Ç—å—Å—è –∏—Å–∫–∞—Ç—å, —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –∏ –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏, —Å—Ç—Ä–æ–∏—Ç—å –¥–∞—à–±–æ—Ä–¥—ã, –Ω–∞—Ö–æ–¥–∏—Ç—å –∑–∞–∫–æ–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç–∏ –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –∞–ª–µ—Ä—Ç—ã.
–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –º–æ–¥—É–ª—è —Ç—ã —Å–º–æ–∂–µ—à–µ—à—å —Ä–∞–±–æ—Ç–∞—Ç—å —Å Kibana –∏ Grafana —Ç–∞–∫ –∂–µ —É–≤–µ—Ä–µ–Ω–Ω–æ, –∫–∞–∫ —Å `grep`.

---

## 1. –ß—Ç–æ —Ç–∞–∫–æ–µ Kibana –∏ Grafana

| –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç  | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                           | –ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö                                                           |
| ----------- | ------------------------------------ | ------------------------------------------------------------------------- |
| **Kibana**  | –≤–∏–∑—É–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫ Elasticsearch | —Ç–æ–ª—å–∫–æ Elasticsearch                                                      |
| **Grafana** | –¥–∞—à–±–æ—Ä–¥—ã –¥–ª—è –º–µ—Ç—Ä–∏–∫ –∏ –ª–æ–≥–æ–≤          | –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–µ—Å—è—Ç–∫–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ (ES, Loki, Prometheus, PostgreSQL –∏ —Ç.–¥.) |

> **Best practice:**
> –ò—Å–ø–æ–ª—å–∑—É–π Kibana –¥–ª—è –≥–ª—É–±–æ–∫–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤, Grafana ‚Äî –¥–ª—è –æ–±—â–∏—Ö –¥–∞—à–±–æ—Ä–¥–æ–≤ –∏ –∞–ª–µ—Ä—Ç–æ–≤.

---

## 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Kibana

```bash
wget https://artifacts.elastic.co/downloads/kibana/kibana-8.14.0-amd64.deb
sudo dpkg -i kibana-8.14.0-amd64.deb
sudo systemctl enable kibana
sudo systemctl start kibana
```

–ü—Ä–æ–≤–µ—Ä–∫–∞:
–û—Ç–∫—Ä–æ–π –±—Ä–∞—É–∑–µ—Ä ‚Üí `http://localhost:5601`
(–µ—Å–ª–∏ Elasticsearch –±–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ ‚Äî Kibana –ø–æ–¥–Ω–∏–º–µ—Ç—Å—è —Å—Ä–∞–∑—É).

**–ö–æ–Ω—Ñ–∏–≥ / etc/kibana/kibana.yml**

```yaml
server.port: 5601
server.host: "0.0.0.0"
elasticsearch.hosts: ["http://127.0.0.1:9200"]
```

---

## 3. –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ –∏ Index Pattern

1. –ó–∞–π–¥–∏ –≤ Kibana ‚Üí **Discover**.
2. –ù–∞–∂–º–∏ **Create index pattern**.
3. –£–∫–∞–∂–∏ –∏–º—è, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–µ —Ç–≤–æ–µ–º—É –∏–Ω–¥–µ–∫—Å—É, –Ω–∞–ø—Ä–∏–º–µ—Ä `fluentd-*`.
4. –í –ø–æ–ª–µ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–±–µ—Ä–∏ `@timestamp`.

–¢–µ–ø–µ—Ä—å Kibana ‚Äú–ø–æ–Ω–∏–º–∞–µ—Ç‚Äù, —á—Ç–æ –∫–∞–∂–¥–∞—è –∑–∞–ø–∏—Å—å –≤ —ç—Ç–æ–º –∏–Ω–¥–µ–∫—Å–µ –∏–º–µ–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—É—é –æ—Å—å ‚Äî –º–æ–∂–Ω–æ —Å—Ç—Ä–æ–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫–∏ –∏ —Ñ–∏–ª—å—Ç—Ä—ã.

---

## 4. –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤ Kibana

### –ü—Ä–∏–º–µ—Ä—ã KQL (Kibana Query Language)

```
level : "ERROR"
service : "nginx" and message : "timeout"
ip : 192.168.* and not level : "INFO"
```

**KQL** –ø–æ–Ω–∏–º–∞–µ—Ç –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã `and`, `or`, `not`, `*`, –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Å–≤–µ—á–∏–≤–∞–µ—Ç —Ç–∏–ø—ã –ø–æ–ª–µ–π.

> üîé –ï—Å–ª–∏ —Ç—ã –∏—â–µ—à—å —Ç–µ–∫—Å—Ç –≤ `message`, –ø–∏—à–∏ –±–µ–∑ –∫–∞–≤—ã—á–µ–∫ ‚Äî Kibana –Ω–∞–π–¥—ë—Ç –ø–æ –ø–æ–¥—Å—Ç—Ä–æ–∫–µ.

---

## 5. –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –≤ Kibana

### 5.1 –°–æ–∑–¥–∞–Ω–∏–µ –¥–∞—à–±–æ—Ä–¥–∞

1. –ü–µ—Ä–µ–π–¥–∏ ‚Üí **Visualize Library** ‚Üí **Create visualization**.
2. –í—ã–±–µ—Ä–∏ —Ç–∏–ø, –Ω–∞–ø—Ä–∏–º–µ—Ä **Area**, **Bar**, **Pie** –∏–ª–∏ **Metric**.
3. –£–∫–∞–∂–∏ –ø–æ–ª–µ –≤—Ä–µ–º–µ–Ω–∏ (`@timestamp`).
4. –ù–∞—Å—Ç—Ä–æ–π –∞–≥—Ä–µ–≥–∞—Ü–∏—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, `Count of records` –ø–æ `level.keyword`).
5. –°–æ—Ö—Ä–∞–Ω–∏ –∏ –¥–æ–±–∞–≤—å –Ω–∞ –¥–∞—à–±–æ—Ä–¥.

### 5.2 –ü—Ä–∏–º–µ—Ä ‚Äì –æ—à–∏–±–∫–∏ –ø–æ —Å–µ—Ä–≤–∏—Å–∞–º

* **X-–æ—Å—å:** `@timestamp`
* **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Ü–≤–µ—Ç—É:** `service.keyword`
* **–§–∏–ª—å—Ç—Ä:** `level : ERROR`
  ‚Üí –ü–æ–ª—É—á–∏—à—å –≥—Ä–∞—Ñ–∏–∫ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ—à–∏–±–æ–∫ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞.

---

## 6. –ê–ª–µ—Ä—Ç—ã –∏ –æ–ø–æ–≤–µ—â–µ–Ω–∏—è –≤ Kibana

Kibana —É–º–µ–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å **Rule-based alerts** ‚Äî —Å—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç, –µ—Å–ª–∏ —É—Å–ª–æ–≤–∏–µ –≤ Elasticsearch –≤—ã–ø–æ–ª–Ω–µ–Ω–æ.

**–ü—Ä–∏–º–µ—Ä:** ‚Äú–ï—Å–ª–∏ –∑–∞ 5 –º–∏–Ω—É—Ç > 10 –æ—à–∏–±–æ–∫ –≤ auth-—Å–µ—Ä–≤–∏—Å–µ ‚Äî —à–ª—ë–º –≤ Slack‚Äù.

1. –ü–µ—Ä–µ–π–¥–∏ ‚Üí **Stack Management ‚Üí Rules and Connectors**
2. –°–æ–∑–¥–∞–π –Ω–æ–≤–æ–µ –ø—Ä–∞–≤–∏–ª–æ `Elasticsearch query`.
3. –ó–∞–ø—Ä–æ—Å:

   ```
   level:"ERROR" and service:"auth"
   ```
4. –ü–µ—Ä–∏–æ–¥: –∫–∞–∂–¥—ã–µ 1 –º–∏–Ω.
5. –î–µ–π—Å—Ç–≤–∏–µ: Slack –∏–ª–∏ Email.

---

## 7. Grafana ‚Äî –≤—Ç–æ—Ä–∞—è –ø–æ–ª–æ–≤–∏–Ω–∞ –º–æ–Ω–µ—Ç—ã

Grafana —á–∞—Å—Ç–æ —Å—Ç–∞–≤–∏—Ç—Å—è –ø–æ–≤–µ—Ä—Ö Kibana, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å –ª–æ–≥–∏ –∏ –º–µ—Ç—Ä–∏–∫–∏.

### 7.1 –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
sudo apt install -y adduser libfontconfig1 musl
wget https://dl.grafana.com/oss/release/grafana_10.3.0_amd64.deb
sudo dpkg -i grafana_10.3.0_amd64.deb
sudo systemctl enable grafana-server
sudo systemctl start grafana-server
```

–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å ‚Äî `http://localhost:3000`, –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `admin/admin`.

---

## 8. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Elasticsearch –∫ Grafana

1. **Configuration ‚Üí Data Sources ‚Üí Add data source**
2. –í—ã–±–µ—Ä–∏ **Elasticsearch**
3. –í–≤–µ–¥–∏ `http://localhost:9200`
4. –£–∫–∞–∂–∏ Index Pattern: `fluentd-*`
5. Time field name: `@timestamp`

–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ —Å—Ç—Ä–æ–∏—Ç—å –¥–∞—à–±–æ—Ä–¥—ã –ø–æ–≤–µ—Ä—Ö —Ç–µ—Ö –∂–µ –ª–æ–≥–æ–≤, —á—Ç–æ –≤ Kibana.

---

## 9. –ü—Ä–∏–º–µ—Ä –¥–∞—à–±–æ—Ä–¥–∞ –≤ Grafana

**–ü–∞–Ω–µ–ª—å 1.** –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ –ø–æ —É—Ä–æ–≤–Ω—é:

```json
Metric: Count  
Group by: level.keyword  
Filter: level != "INFO"
```

**–ü–∞–Ω–µ–ª—å 2.** –¢–æ–ø 10 IP —Å –Ω–∞–∏–±–æ–ª—å—à–∏–º —á–∏—Å–ª–æ–º –æ—à–∏–±–æ–∫:

```json
Metric: Count  
Group by: ip.keyword  
Order: desc  
Limit: 10
```

**–ü–∞–Ω–µ–ª—å 3.** –ß–∞—Å—Ç–æ—Ç–∞ –æ—à–∏–±–æ–∫ –≤–æ –≤—Ä–µ–º–µ–Ω–∏ (‚Äúheatmap‚Äù):

```json
Metric: Count  
Group by: Date histogram (@timestamp)
```

> **–°–æ–≤–µ—Ç:** –≤ Grafana —Å—Ç–∞–≤—å ‚Äúauto-refresh = 1 min‚Äù –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏.

---

## 10. –ê–ª–µ—Ä—Ç–∏–Ω–≥ –≤ Grafana

Grafana —É–º–µ–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –≥–∏–±–∫–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã –ø–æ –ª—é–±–æ–º—É –∑–∞–ø—Ä–æ—Å—É.

**–ü—Ä–∏–º–µ—Ä:**
–µ—Å–ª–∏ –∑–∞ 5 –º–∏–Ω—É—Ç > 5 –æ—à–∏–±–æ–∫ –∏–∑ –æ–¥–Ω–æ–≥–æ IP ‚Äî –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ Telegram.

1. –í –ø–∞–Ω–µ–ª–∏ –Ω–∞–∂–º–∏ **Alert ‚Üí Create alert rule**
2. –í—ã–±–µ—Ä–∏ –º–µ—Ç—Ä–∏–∫—É Count of records (`level="ERROR"`)
3. –£—Å–ª–æ–≤–∏–µ: `IS ABOVE 5`
4. –ò–Ω—Ç–µ—Ä–≤–∞–ª: `5m`
5. –î–µ–π—Å—Ç–≤–∏–µ: Webhook/Telegram.

---

## üîß –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è

### –ó–∞–¥–∞–Ω–∏–µ 1. –°–æ–∑–¥–∞–π –¥–∞—à–±–æ—Ä–¥ –æ—à–∏–±–æ–∫

1. –°–æ–±–µ—Ä–∏ –ª–æ–≥–∏ –≤ Elasticsearch.
2. –í Kibana —Å–æ–∑–¥–∞–π –¥–∞—à–±–æ—Ä–¥ ‚Äú–û—à–∏–±–∫–∏ –ø–æ –≤—Ä–µ–º–µ–Ω–∏‚Äù.
3. –î–æ–±–∞–≤—å —Ñ–∏–ª—å—Ç—Ä –ø–æ `service.keyword`.

### –ó–∞–¥–∞–Ω–∏–µ 2. –ü–æ—Å—Ç—Ä–æ–π —Ç–æ–ø-IP –≤ Grafana

1. –ü–æ–¥–∫–ª—é—á–∏ Elasticsearch –≤ Grafana.
2. –°–æ–∑–¥–∞–π –ø–∞–Ω–µ–ª—å ‚ÄúTop 10 IP –ø–æ –æ—à–∏–±–∫–∞–º‚Äù.
3. –ù–∞—Å—Ç—Ä–æ–π –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞–∑ –≤ –º–∏–Ω—É—Ç—É.

### –ó–∞–¥–∞–Ω–∏–µ 3. –ù–∞—Å—Ç—Ä–æ–π –æ–ø–æ–≤–µ—â–µ–Ω–∏–µ

1. –°–æ–∑–¥–∞–π alert –≤ Kibana –¥–ª—è `service:auth`.
2. –î–æ–±–∞–≤—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Slack –∏–ª–∏ Email.

---

## üìä –¢–µ—Å—Ç –ø–æ –º–æ–¥—É–ª—é 5

1. –ö–∞–∫ —Å–≤—è–∑–∞–Ω—ã Kibana –∏ Elasticsearch?
2. –ß—Ç–æ —Ç–∞–∫–æ–µ Index Pattern –∏ –∑–∞—á–µ–º –æ–Ω –Ω—É–∂–µ–Ω?
3. –ö–∞–∫–æ–π —è–∑—ã–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –ø–æ–∏—Å–∫–µ Kibana?
4. –ú–æ–∂–Ω–æ –ª–∏ Grafana –ø–æ–¥–∫–ª—é—á–∏—Ç—å –∫ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º –ª–æ–≥–æ–≤?
5. –ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å alert –≤ Kibana?

---

## üß† Best Practices

1. **–û–¥–∏–Ω –¥–∞—à–±–æ—Ä–¥ ‚Äî –æ–¥–Ω–∞ —Ç–µ–º–∞.** –†–∞–∑–¥–µ–ª—è–π: –æ—à–∏–±–∫–∏, –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è.
2. **–ò—Å–ø–æ–ª—å–∑—É–π —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ `service` –∏ `level`.** –≠—Ç–æ —É—Å–∫–æ—Ä—è–µ—Ç —Ä–∞–±–æ—Ç—É.
3. **–í–∫–ª—é—á–∞–π auto-refresh** –¥–ª—è –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞.
4. **–û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–π Retention** –≤ Kibana ‚Äî –Ω–µ —Å—Ç—Ä–æ–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫–∏ –∑–∞ –≥–æ–¥.
5. **–î–µ–ª–∞–π –¥–∞—à–±–æ—Ä–¥—ã –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–º–∏:** –æ–±—â–∏–µ ‚Üí –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ —Å–µ—Ä–≤–∏—Å—É.

---

–ü–æ—Å–ª–µ –º–æ–¥—É–ª—è 5 —Ç—ã —É–º–µ–µ—à—å:
* —Ä–∞–±–æ—Ç–∞—Ç—å –≤ Kibana –∏ Grafana;
* –∏—Å–∫–∞—Ç—å –∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏ –ø–æ KQL;
* —Å—Ç—Ä–æ–∏—Ç—å –¥–∞—à–±–æ—Ä–¥—ã –∏ –∞–ª–µ—Ä—Ç—ã;
* –æ–±—ä–µ–¥–∏–Ω—è—Ç—å –ª–æ–≥–∏ –∏ –º–µ—Ç—Ä–∏–∫–∏ –≤ –æ–¥–Ω–æ–º –≤–∏–¥–µ;
* –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –æ—Ç –æ—à–∏–±–∫–∏ –≤ –≥—Ä–∞—Ñ–∏–∫–µ –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É —Å–æ–æ–±—â–µ–Ω–∏—é –≤ –ª–æ–≥–∞—Ö.

---

# **–ú–û–î–£–õ–¨ 6. GRAYLOG –ò –ê–õ–¨–¢–ï–†–ù–ê–¢–ò–í–ù–´–ï –†–ï–®–ï–ù–ò–Ø**

---

## üéØ –¶–µ–ª—å

–û—Å–≤–æ–∏—Ç—å —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫—É Graylog, –ø–æ–Ω—è—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É, —Ñ–∏–ª—å—Ç—Ä—ã –∏ –ø–æ—Ç–æ–∫–∏, –Ω–∞—É—á–∏—Ç—å—Å—è —Å–æ–±–∏—Ä–∞—Ç—å –ª–æ–≥–∏ –æ—Ç rsyslog, Fluent Bit –∏ Docker.
–ü–æ—Å–ª–µ –º–æ–¥—É–ª—è —Ç—ã —Å–º–æ–∂–µ—à—å –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –≥–æ—Ç–æ–≤—ã–π –ø—Ä–æ–¥–∞–∫—à–Ω-—É—Ä–æ–≤–µ–Ω—å —Å—Ç–µ–∫ –ª–æ–≥–æ–≤ –±–µ–∑ ELK.

---

## 1. –ß—Ç–æ —Ç–∞–∫–æ–µ Graylog

Graylog ‚Äî —ç—Ç–æ **–ª–æ–≥-–ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ ‚Äú–≤—Å—ë-–≤-–æ–¥–Ω–æ–º‚Äù**, –æ–±—ä–µ–¥–∏–Ω—è—é—â–∞—è:

* —Å–±–æ—Ä –ª–æ–≥–æ–≤ (—á–µ—Ä–µ–∑ Syslog, GELF, Beats, HTTP),
* —Ö—Ä–∞–Ω–µ–Ω–∏–µ (–≤ Elasticsearch –∏–ª–∏ OpenSearch),
* –ø–æ–∏—Å–∫ –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é (–≤ —Å–≤–æ—ë–º –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ),
* –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é –∏ –æ–±—Ä–∞–±–æ—Ç–∫—É (Streams –∏ Pipelines).

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**

```
Input ‚Üí Journal (Kafka-–ø–æ–¥–æ–±–Ω–∞—è –æ—á–µ—Ä–µ–¥—å) ‚Üí Processing ‚Üí Elasticsearch ‚Üí UI
```

–õ–æ–≥–∏ —Å–Ω–∞—á–∞–ª–∞ –ø–æ–ø–∞–¥–∞—é—Ç –≤ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π **journal** ‚Äî –Ω–∞–¥—ë–∂–Ω—É—é –æ—á–µ—Ä–µ–¥—å –Ω–∞ –¥–∏—Å–∫–µ,
–∞ –∑–∞—Ç–µ–º –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∏ –∏–Ω–¥–µ–∫—Å–∏—Ä—É—é—Ç—Å—è –≤ Elasticsearch.

---

## 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ (Docker Compose)

–°–æ–∑–¥–∞–¥–∏–º –ø—Ä–æ—Å—Ç–æ–π –∫–ª–∞—Å—Ç–µ—Ä: MongoDB (–º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ), Elasticsearch (—Ö—Ä–∞–Ω–∏–ª–∏—â–µ), Graylog (–æ–±—Ä–∞–±–æ—Ç–∫–∞).

**docker-compose.yml**

```yaml
version: '3'
services:
  mongo:
    image: mongo:6
    restart: always
    volumes:
      - ./mongo_data:/data/db

  elasticsearch:
    image: docker.elastic.co/elasticsearch/elasticsearch:8.14.0
    environment:
      - discovery.type=single-node
      - xpack.security.enabled=false
    ulimits:
      memlock:
        soft: -1
        hard: -1
    volumes:
      - ./es_data:/usr/share/elasticsearch/data

  graylog:
    image: graylog/graylog:6.0
    environment:
      - GRAYLOG_HTTP_EXTERNAL_URI=http://localhost:9000/
      - GRAYLOG_PASSWORD_SECRET=SomeRandomLongString
      - GRAYLOG_ROOT_PASSWORD_SHA2=$(echo -n "admin" | sha256sum | awk '{print $1}')
      - GRAYLOG_ELASTICSEARCH_HOSTS=http://elasticsearch:9200
      - GRAYLOG_MONGODB_URI=mongodb://mongo/graylog
    entrypoint: /usr/bin/tini -- wait-for-it elasticsearch:9200 -- /docker-entrypoint.sh
    depends_on:
      - mongo
      - elasticsearch
    ports:
      - "9000:9000"   # Web UI
      - "1514:1514/udp" # Syslog input
      - "12201:12201/udp" # GELF input
```

**–ß—Ç–æ –∑–¥–µ—Å—å –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**

* **mongo** —Ö—Ä–∞–Ω–∏—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (inputs, users, –¥–∞—à–±–æ—Ä–¥—ã);
* **elasticsearch** ‚Äî —Ö—Ä–∞–Ω–∏—Ç —Å–∞–º–∏ –ª–æ–≥–∏;
* **graylog** ‚Äî —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —É–∑–µ–ª –ø—Ä–∏—ë–º–∞ –∏ –∞–Ω–∞–ª–∏–∑–∞ –ª–æ–≥–æ–≤;
* –ø–æ—Ä—Ç—ã `1514/udp` –∏ `12201/udp` —Å–ª—É—à–∞—é—Ç –≤—Ö–æ–¥—è—â–∏–µ –ª–æ–≥–∏ (Syslog –∏ GELF);
* –≤–µ–±-–ø–∞–Ω–µ–ª—å –¥–æ—Å—Ç—É–ø–Ω–∞ –Ω–∞ `http://localhost:9000`.

---

## 3. –ü–µ—Ä–≤–∏—á–Ω—ã–π –≤—Ö–æ–¥

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞:

```bash
docker-compose up -d
```

–ü–µ—Ä–µ–π–¥–∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:
`http://localhost:9000`
–õ–æ–≥–∏–Ω: `admin`, –ø–∞—Ä–æ–ª—å: `admin`

Graylog –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Å—Ç –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –∏ –∫—ç—à –æ—á–µ—Ä–µ–¥–∏.

---

## 4. Inputs ‚Äî –ø—Ä–∏—ë–º –ª–æ–≥–æ–≤

Graylog —É–º–µ–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å –¥–µ—Å—è—Ç–∫–∏ —Ñ–æ—Ä–º–∞—Ç–æ–≤. –û—Å–Ω–æ–≤–Ω—ã–µ:

* **Syslog UDP/TCP**
* **GELF (Graylog Extended Log Format)** ‚Äî —Ä–æ–¥–Ω–æ–π —Ñ–æ—Ä–º–∞—Ç JSON.
* **Beats / HTTP / Raw TCP**

### –ü—Ä–∏–º–µ—Ä –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Syslog-input:

1. –í UI ‚Üí **System ‚Üí Inputs ‚Üí Syslog UDP ‚Üí Launch new input**
2. Port: `1514`
3. Bind address: `0.0.0.0`
4. –ù–∞–∑–æ–≤–∏ input, –Ω–∞–ø—Ä–∏–º–µ—Ä `syslog-input`.

–¢–µ–ø–µ—Ä—å —Å–µ—Ä–≤–µ—Ä —Å–ª—É—à–∞–µ—Ç –ø–æ—Ä—Ç 1514.

---

## 5. –û—Ç–ø—Ä–∞–≤–∫–∞ –ª–æ–≥–æ–≤ —Å –∫–ª–∏–µ–Ω—Ç–∞ (rsyslog)

–ù–∞ –∫–ª–∏–µ–Ω—Ç–µ —Å–æ–∑–¥–∞—ë–º —Ñ–∞–π–ª `/etc/rsyslog.d/90-graylog.conf`:

```
*.*  @graylog-server:1514
```

–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫:

```bash
systemctl restart rsyslog
```

–¢–µ–ø–µ—Ä—å –≤—Å–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ª–æ–≥–∏ —Å –∫–ª–∏–µ–Ω—Ç–∞ –±—É–¥—É—Ç —Å—Ç–µ–∫–∞—Ç—å—Å—è –≤ Graylog.

---

## 6. Streams ‚Äî –ø–æ—Ç–æ–∫–∏ –ª–æ–≥–æ–≤

**Streams** ‚Äî –º–æ—â–Ω–∞—è —Ñ–∏—á–∞, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–∞–∑–¥–µ–ª—è—Ç—å –ø–æ—Ç–æ–∫–∏ –ª–æ–≥–æ–≤ –ø–æ —É—Å–ª–æ–≤–∏—è–º.
–ö–∞–∂–¥—ã–π stream ‚Äî —ç—Ç–æ –∫–∞–∫ —Ñ–∏–ª—å—Ç—Ä: ‚Äú–≤—Å—ë, –≥–¥–µ `facility=auth` ‚Äî –≤ –ø–æ—Ç–æ–∫ Security‚Äù.

**–ü—Ä–∏–º–µ—Ä:**

1. –°–æ–∑–¥–∞–π Stream `Auth Logs`.
2. –£—Å–ª–æ–≤–∏–µ: `source` —Å–æ–¥–µ—Ä–∂–∏—Ç `auth`.
3. –ù–∞–∑–Ω–∞—á—å –∏–Ω–¥–µ–∫—Å `auth-logs`.

–¢–µ–ø–µ—Ä—å –≤—Å–µ –ª–æ–≥–∏ —Å ‚Äúauth‚Äù –±—É–¥—É—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ –∏ –∏–º–µ—Ç—å —Å–≤–æ–∏ –¥–∞—à–±–æ—Ä–¥—ã.

---

## 7. Extractors ‚Äî –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

**Extractors** –ø—Ä–µ–≤—Ä–∞—â–∞—é—Ç —Å—ã—Ä—ã–µ —Å—Ç—Ä–æ–∫–∏ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—è.

–ü—Ä–∏–º–µ—Ä –ª–æ–≥-—Å—Ç—Ä–æ–∫–∏:

```
Oct 07 10:21:18 debian sshd[3181]: Failed password for root from 185.241.56.77 port 51822 ssh2
```

–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å extractor —Ç–∏–ø–∞ **Regex**:

```
Failed password for (?<user>\S+) from (?<ip>\d+\.\d+\.\d+\.\d+)
```

‚Üí Graylog –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Å—Ç –ø–æ–ª—è:

```
user=root
ip=185.241.56.77
```

---

## 8. Pipelines ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ª–æ–≥–æ–≤

Pipelines –ø–æ–∑–≤–æ–ª—è—é—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å —Å–ª–æ–∂–Ω—É—é –ª–æ–≥–∏–∫—É –æ–±—Ä–∞–±–æ—Ç–∫–∏:

* —É–¥–∞–ª—è—Ç—å –ø–æ–ª—è,
* –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å —É—Ä–æ–≤–Ω–∏ (`WARN` ‚Üí `WARNING`),
* –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—Ç—å –ø–æ—Ç–æ–∫–∏.

–ü—Ä–∏–º–µ—Ä pipeline-–ø—Ä–∞–≤–∏–ª–∞:

```pseudocode
rule "normalize nginx levels"
when
  has_field("level") && to_lowercase($message.level) == "warn"
then
  set_field("level", "WARNING");
end
```

---

## 9. –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∏ –ø–æ–∏—Å–∫

Graylog –∏–º–µ–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π **Search** –∏ **Dashboards**.

–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–æ–≤ (Lucene-—Å–∏–Ω—Ç–∞–∫—Å–∏—Å):

```
level:ERROR
source:nginx AND message:"timeout"
ip:192.168.*
```

–ú–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∫–∞–∫ ‚Äú–≤–∏–¥–∂–µ—Ç—ã‚Äù –∏ —Å–æ–±–∏—Ä–∞—Ç—å –∏–∑ –Ω–∏—Ö –¥–∞—à–±–æ—Ä–¥—ã:

* Errors per Service
* Top IPs
* SSH Brute-Force Attempts

---

## 10. –ê–ª–µ—Ä—Ç—ã –≤ Graylog

–ê–ª–µ—Ä—Ç—ã (Event Definitions) —Å—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –ø–æ —É—Å–ª–æ–≤–∏—è–º: ‚Äú–µ—Å–ª–∏ –∑–∞ 1 –º–∏–Ω—É—Ç—É > 10 ERROR‚Äù.

1. **Alerts ‚Üí Event Definitions ‚Üí Create Event Definition**
2. –£—Å–ª–æ–≤–∏–µ:

   ```
   level:ERROR AND service:auth
   ```
3. Frequency: 1 –º–∏–Ω—É—Ç–∞
4. Action: Email / HTTP Webhook / Slack.

---

## üîß –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è

### –ó–∞–¥–∞–Ω–∏–µ 1. –†–∞–∑–≤–µ—Ä–Ω–∏ Graylog –≤ Docker

1. –°–∫–ª–æ–Ω–∏—Ä—É–π compose-—Ñ–∞–π–ª.
2. –ü–æ–¥–Ω–∏–º–∏ –∫–ª–∞—Å—Ç–µ—Ä.
3. –ü—Ä–æ–≤–µ—Ä—å –≤–µ–±-–ø–∞–Ω–µ–ª—å –Ω–∞ `http://localhost:9000`.

### –ó–∞–¥–∞–Ω–∏–µ 2. –ù–∞—Å—Ç—Ä–æ–π –ø—Ä–∏—ë–º Syslog

1. –°–æ–∑–¥–∞–π input Syslog UDP (–ø–æ—Ä—Ç 1514).
2. –ù–∞—Å—Ç—Ä–æ–π –∫–ª–∏–µ–Ω—Ç rsyslog –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ª–æ–≥–æ–≤.
3. –£–±–µ–¥–∏—Å—å, —á—Ç–æ –ª–æ–≥–∏ –ø–æ—è–≤–ª—è—é—Ç—Å—è –≤ ‚ÄúSearch‚Äù.

### –ó–∞–¥–∞–Ω–∏–µ 3. –°–æ–∑–¥–∞–π Stream –∏ Extractor

1. –°–æ–∑–¥–∞–π –ø–æ—Ç–æ–∫ `SSH Logs`.
2. –ù–∞—Å—Ç—Ä–æ–π extractor –ø–æ –ø–æ–ª—é `ip`.
3. –°–¥–µ–ª–∞–π –≥—Ä–∞—Ñ–∏–∫ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞ –ø–æ IP.

---

## üìä –¢–µ—Å—Ç –ø–æ –º–æ–¥—É–ª—é 6

1. –ò–∑ —á–µ–≥–æ —Å–æ—Å—Ç–æ–∏—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Graylog?
2. –î–ª—è —á–µ–≥–æ –Ω—É–∂–µ–Ω journal?
3. –ß–µ–º Streams –æ—Ç–ª–∏—á–∞—é—Ç—Å—è –æ—Ç Pipelines?
4. –ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å extractor –∏ —á—Ç–æ –æ–Ω –¥–µ–ª–∞–µ—Ç?
5. –ù–∞ –∫–∞–∫–æ–º –ø–æ—Ä—Ç—É Graylog —Å–ª—É—à–∞–µ—Ç Syslog UDP –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é?

---

## üß† Best Practices

1. **–í–∫–ª—é—á–∏ –∂—É—Ä–Ω–∞–ª (journal):** –æ–Ω —Å–ø–∞—Å–∞–µ—Ç –ª–æ–≥–∏ –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ Elasticsearch.
2. **–†–∞–∑–¥–µ–ª—è–π –ø–æ—Ç–æ–∫–∏ –ø–æ —Ç–∏–ø–∞–º:** —Å–∏—Å—Ç–µ–º–Ω—ã–µ, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
3. **–ù–µ –æ—Ç–ø—Ä–∞–≤–ª—è–π –≤ Graylog ‚ÄúDEBUG‚Äù-—É—Ä–æ–≤–µ–Ω—å** ‚Äî —ç–∫–æ–Ω–æ–º—å –º–µ—Å—Ç–æ.
4. **–ò—Å–ø–æ–ª—å–∑—É–π GELF** –≤–º–µ—Å—Ç–æ plain-syslog ‚Äî –±—ã—Å—Ç—Ä–µ–µ, –±–µ–∑ –ø–æ—Ç–µ—Ä—å —Ñ–æ—Ä–º–∞—Ç–∞.
5. **–†–µ–≥—É–ª—è—Ä–Ω–æ —á–∏—Å—Ç–∏ –∏–Ω–¥–µ–∫—Å—ã** (—á–µ—Ä–µ–∑ Index Sets), —á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ–ø–æ–ª–Ω–∏—Ç—å ES.
6. **–•—Ä–∞–Ω–∏ Extractors –∏ Pipelines –≤ Git** ‚Äî —ç—Ç–æ –∫–æ–¥ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã.

---

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –º–æ–¥—É–ª—è —Ç—ã —É–º–µ–µ—à—å:
* –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞—Ç—å Graylog;
* –ü—Ä–∏–Ω–∏–º–∞—Ç—å –ª–æ–≥–∏ —á–µ—Ä–µ–∑ Syslog –∏ GELF;
* –°–æ–∑–¥–∞–≤–∞—Ç—å Streams, Extractors –∏ Pipelines;
* –°—Ç—Ä–æ–∏—Ç—å –¥–∞—à–±–æ—Ä–¥—ã –∏ –∞–ª–µ—Ä—Ç—ã;
* –†–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ Fluentd, –µ—Å–ª–∏ –Ω—É–∂–Ω–∞ –ª—ë–≥–∫–∞—è –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ ELK.

---
